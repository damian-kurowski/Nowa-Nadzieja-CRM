{% extends 'base.html.twig' %}

{% block title %}Historia Zebrań Okręgu - {{ okreg.nazwa }}{% endblock %}

{% block body %}
<div class="history-container">
    <!-- Header Section -->
    <div class="history-header">
        <div class="header-content">
            <div class="header-main">
                <div class="history-breadcrumb">
                    <a href="{{ path('zebranie_okregu_index') }}" class="breadcrumb-link">
                        <i class="fas fa-users-cog"></i>
                        <span>Zebrania Okręgu</span>
                    </a>
                    <i class="fas fa-chevron-right breadcrumb-separator"></i>
                    <span class="breadcrumb-current">Historia {{ okreg.nazwa }}</span>
                </div>
                <h1 class="history-title">
                    Historia Walnych Zebrań Członków Okręgu
                    <span class="history-district">{{ okreg.nazwa }}</span>
                </h1>
                <div class="history-meta">
                    <div class="meta-item">
                        <i class="fas fa-history"></i>
                        <span>{{ zebrania|length }} zakończonych zebrań</span>
                    </div>
                </div>
            </div>
            <div class="header-actions">
                <a href="{{ path('zebranie_okregu_index') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Powrót do Zebrań
                </a>
            </div>
        </div>
    </div>

    <!-- Timeline Section -->
    <div class="history-content">
        {% if zebrania|length > 0 %}
            <div class="timeline-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-timeline"></i> 
                        Chronologia Zebrań
                    </h2>
                    <div class="section-divider"></div>
                </div>
                
                <div class="timeline">
                    {% for zebranie in zebrania %}
                        <div class="timeline-item">
                            <div class="timeline-marker">
                                <div class="marker-dot completed">
                                    <i class="fas fa-check"></i>
                                </div>
                                <div class="marker-line"></div>
                            </div>
                            
                            <div class="timeline-content">
                                <div class="timeline-card">
                                    <div class="card-header">
                                        <div class="card-date">
                                            <div class="date-day">{{ zebranie.dataZakonczenia|date('d') }}</div>
                                            <div class="date-month-year">
                                                {{ zebranie.dataZakonczenia|date('M Y') }}
                                            </div>
                                        </div>
                                        <div class="card-status">
                                            <span class="status-badge completed">
                                                <i class="fas fa-flag-checkered"></i>
                                                Zakończone
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="card-body">
                                        <h3 class="meeting-title">
                                            Walne Zebranie Członków Okręgu
                                        </h3>
                                        
                                        <div class="meeting-details">
                                            <div class="detail-row">
                                                <strong>Rozpoczęte:</strong> 
                                                {{ zebranie.dataUtworzenia|date('d.m.Y H:i') }}
                                            </div>
                                            <div class="detail-row">
                                                <strong>Zakończone:</strong> 
                                                {{ zebranie.dataZakonczenia|date('d.m.Y H:i') }}
                                            </div>
                                            <div class="detail-row">
                                                <strong>Czas trwania:</strong>
                                                {% set duration = date(zebranie.dataZakonczenia).diff(date(zebranie.dataUtworzenia)) %}
                                                {% if duration.days > 0 %}
                                                    {{ duration.days }}d {{ duration.h }}h {{ duration.i }}m
                                                {% else %}
                                                    {{ duration.h }}h {{ duration.i }}m
                                                {% endif %}
                                            </div>
                                        </div>
                                        
                                        <div class="participants-summary">
                                            <h4><i class="fas fa-users"></i> Uczestnicy</h4>
                                            <div class="participants-list">
                                                <div class="participant-item">
                                                    <div class="participant-role">Obserwator</div>
                                                    <div class="participant-name">{{ zebranie.obserwator.imie }} {{ zebranie.obserwator.nazwisko }}</div>
                                                </div>
                                                {% if zebranie.protokolant %}
                                                    <div class="participant-item">
                                                        <div class="participant-role">Protokolant</div>
                                                        <div class="participant-name">{{ zebranie.protokolant.imie }} {{ zebranie.protokolant.nazwisko }}</div>
                                                    </div>
                                                {% endif %}
                                                {% if zebranie.prowadzacy %}
                                                    <div class="participant-item">
                                                        <div class="participant-role">Prowadzący</div>
                                                        <div class="participant-name">{{ zebranie.prowadzacy.imie }} {{ zebranie.prowadzacy.nazwisko }}</div>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        
                                        {% if zebranie.isManagementComplete %}
                                            <div class="elected-management">
                                                <h4><i class="fas fa-crown"></i> Wybrany Zarząd</h4>
                                                <div class="management-grid">
                                                    <div class="management-item president">
                                                        <div class="management-icon">
                                                            <i class="fas fa-star"></i>
                                                        </div>
                                                        <div class="management-info">
                                                            <div class="management-role">Prezes Okręgu</div>
                                                            <div class="management-name">{{ zebranie.prezesOkregu.imie }} {{ zebranie.prezesOkregu.nazwisko }}</div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="management-item vice-president">
                                                        <div class="management-icon">
                                                            <i class="fas fa-medal"></i>
                                                        </div>
                                                        <div class="management-info">
                                                            <div class="management-role">Wiceprezes I</div>
                                                            <div class="management-name">{{ zebranie.wiceprezes1.imie }} {{ zebranie.wiceprezes1.nazwisko }}</div>
                                                        </div>
                                                    </div>
                                                    
                                                    {% if zebranie.wiceprezes2 %}
                                                        <div class="management-item vice-president">
                                                            <div class="management-icon">
                                                                <i class="fas fa-medal"></i>
                                                            </div>
                                                            <div class="management-info">
                                                                <div class="management-role">Wiceprezes II</div>
                                                                <div class="management-name">{{ zebranie.wiceprezes2.imie }} {{ zebranie.wiceprezes2.nazwisko }}</div>
                                                            </div>
                                                        </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        {% endif %}
                                        
                                        {% if zebranie.dokumenty|length > 0 %}
                                            <div class="documents-summary">
                                                <h4><i class="fas fa-file-alt"></i> Dokumenty ({{ zebranie.dokumenty|length }})</h4>
                                                <div class="documents-preview">
                                                    {% for dokument in zebranie.dokumenty %}
                                                        <div class="document-preview">
                                                            <i class="fas fa-file-alt"></i>
                                                            <span>{{ dokument.tytul }}</span>
                                                        </div>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="card-footer">
                                        <a href="{{ path('zebranie_okregu_historia_szczegoly', {okregId: okreg.id, zebranieId: zebranie.id}) }}" class="btn btn-primary">
                                            <i class="fas fa-eye"></i> Szczegóły Zebrania
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% else %}
            <!-- Empty State -->
            <div class="empty-state">
                <div class="empty-illustration">
                    <div class="illustration-icon">
                        <i class="fas fa-history"></i>
                    </div>
                </div>
                <div class="empty-content">
                    <h3 class="empty-title">Brak Historii Zebrań</h3>
                    <p class="empty-description">
                        W okręgu {{ okreg.nazwa }} nie odbyły się jeszcze żadne zakończone zebrania członków.
                    </p>
                    {% if is_granted('ROLE_SEKRETARZ_PARTII') %}
                        <a href="{{ path('zebranie_okregu_new') }}" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            Rozpocznij Pierwsze Zebranie
                        </a>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    </div>
</div>

<style>
/* History Container */
.history-container {
    min-height: 100vh;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 0;
    color: white;
}

.history-header {
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255,255,255,0.2);
    padding: 2rem;
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 1200px;
    margin: 0 auto;
}

.history-breadcrumb {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
    font-size: 0.9rem;
    color: rgba(255,255,255,0.8);
}

.breadcrumb-link {
    color: rgba(255,255,255,0.8);
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 0.3rem;
    transition: color 0.2s ease;
}

.breadcrumb-link:hover {
    color: white;
}

.breadcrumb-separator {
    font-size: 0.7rem;
    color: rgba(255,255,255,0.5);
}

.breadcrumb-current {
    color: white;
    font-weight: 500;
}

.history-title {
    font-size: 2rem;
    font-weight: 700;
    margin: 0 0 0.5rem 0;
    line-height: 1.2;
}

.history-district {
    display: block;
    font-size: 1.2rem;
    font-weight: 400;
    color: rgba(255,255,255,0.9);
    margin-top: 0.2rem;
}

.history-meta {
    display: flex;
    gap: 1rem;
    margin-top: 0.8rem;
}

.meta-item {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    font-size: 0.9rem;
    color: rgba(255,255,255,0.8);
}

.meta-item i {
    color: rgba(255,255,255,0.6);
}

/* Section Headers */
.section-header {
    margin-bottom: 2rem;
    text-align: center;
}

.section-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: white;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.section-divider {
    width: 60px;
    height: 2px;
    background: rgba(255,255,255,0.3);
    margin: 0 auto;
    border-radius: 1px;
}

/* Timeline */
.history-content {
    padding: 2rem;
    max-width: 1200px;
    margin: 0 auto;
}

.timeline {
    position: relative;
    padding-left: 2rem;
}

.timeline-item {
    position: relative;
    margin-bottom: 2rem;
    display: flex;
    gap: 2rem;
}

.timeline-item:last-child .marker-line {
    display: none;
}

.timeline-marker {
    position: relative;
    flex-shrink: 0;
}

.marker-dot {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #10b981;
    color: white;
    font-size: 0.9rem;
    position: relative;
    z-index: 2;
}

.marker-line {
    position: absolute;
    left: 50%;
    top: 40px;
    width: 2px;
    height: 60px;
    background: rgba(255,255,255,0.2);
    transform: translateX(-50%);
}

.timeline-content {
    flex: 1;
}

.timeline-card {
    background: rgba(255,255,255,0.1);
    border-radius: 12px;
    overflow: hidden;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.15);
    transition: all 0.2s ease;
}

.timeline-card:hover {
    background: rgba(255,255,255,0.15);
    transform: translateY(-2px);
}

.card-header {
    padding: 1.5rem 1.5rem 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid rgba(255,255,255,0.1);
}

.card-date {
    text-align: center;
}

.date-day {
    font-size: 2rem;
    font-weight: 700;
    color: white;
    line-height: 1;
}

.date-month-year {
    font-size: 0.8rem;
    color: rgba(255,255,255,0.8);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 0.2rem;
}

.status-badge {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    background: rgba(16,185,129,0.2);
    color: #6ee7b7;
    padding: 0.4rem 0.8rem;
    border-radius: 15px;
    font-size: 0.8rem;
    font-weight: 500;
}

.card-body {
    padding: 1.5rem;
}

.meeting-title {
    font-size: 1.3rem;
    font-weight: 600;
    color: white;
    margin-bottom: 1rem;
}

.meeting-details {
    margin-bottom: 1.5rem;
}

.detail-row {
    display: flex;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
}

.detail-row strong {
    color: rgba(255,255,255,0.8);
    min-width: 110px;
    margin-right: 0.5rem;
}

.participants-summary,
.elected-management,
.documents-summary {
    margin-bottom: 1.5rem;
}

.participants-summary h4,
.elected-management h4,
.documents-summary h4 {
    font-size: 1rem;
    font-weight: 600;
    color: white;
    margin-bottom: 0.8rem;
    display: flex;
    align-items: center;
    gap: 0.4rem;
}

.participants-list {
    display: grid;
    gap: 0.6rem;
}

.participant-item {
    display: flex;
    gap: 0.8rem;
    padding: 0.6rem;
    background: rgba(255,255,255,0.08);
    border-radius: 6px;
}

.participant-role {
    font-size: 0.75rem;
    color: rgba(255,255,255,0.7);
    text-transform: uppercase;
    font-weight: 600;
    letter-spacing: 0.3px;
    min-width: 80px;
}

.participant-name {
    color: white;
    font-weight: 500;
    font-size: 0.9rem;
}

.management-grid {
    display: grid;
    gap: 0.8rem;
}

.management-item {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    padding: 0.8rem;
    background: rgba(255,255,255,0.08);
    border-radius: 6px;
    border-left: 4px solid transparent;
}

.management-item.president {
    border-left-color: #f59e0b;
}

.management-item.vice-president {
    border-left-color: #8b5cf6;
}

.management-icon {
    width: 30px;
    height: 30px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 0.8rem;
}

.management-item.president .management-icon {
    background: #f59e0b;
}

.management-item.vice-president .management-icon {
    background: #8b5cf6;
}

.management-role {
    font-size: 0.75rem;
    color: rgba(255,255,255,0.7);
    text-transform: uppercase;
    font-weight: 600;
    letter-spacing: 0.3px;
    margin-bottom: 0.1rem;
}

.management-name {
    color: white;
    font-weight: 500;
    font-size: 0.9rem;
}

.documents-preview {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.document-preview {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    background: rgba(255,255,255,0.08);
    padding: 0.4rem 0.8rem;
    border-radius: 15px;
    font-size: 0.8rem;
    color: rgba(255,255,255,0.9);
}

.document-preview i {
    color: #3b82f6;
}

.card-footer {
    padding: 1rem 1.5rem;
    background: rgba(255,255,255,0.05);
    border-top: 1px solid rgba(255,255,255,0.08);
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 4rem 2rem;
}

.empty-illustration {
    margin-bottom: 2rem;
}

.illustration-icon {
    width: 80px;
    height: 80px;
    background: rgba(255,255,255,0.1);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(255,255,255,0.6);
    font-size: 2rem;
    margin: 0 auto;
}

.empty-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: white;
    margin-bottom: 1rem;
}

.empty-description {
    font-size: 1rem;
    color: rgba(255,255,255,0.8);
    margin-bottom: 2rem;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
    line-height: 1.5;
}

/* Dark Mode Support */
[data-bs-theme="dark"] .history-container {
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
}

/* Responsive Design */
@media (max-width: 768px) {
    .header-content {
        flex-direction: column;
        text-align: center;
        gap: 1.5rem;
    }
    
    .timeline {
        padding-left: 1rem;
    }
    
    .timeline-item {
        gap: 1rem;
    }
    
    .card-header {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
    
    .history-content {
        padding: 1rem;
    }
    
    .history-header {
        padding: 1.5rem 1rem;
    }
}
</style>
{% endblock %}
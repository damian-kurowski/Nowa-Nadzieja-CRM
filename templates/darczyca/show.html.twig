{% extends 'base.html.twig' %}

{% block title %}{{ darczyca.pelneImieNazwisko }} - Szczegóły Darczyńcy{% endblock %}

{% block page_title %}
    <div class="d-flex align-items-center">
        <i class="fas fa-hand-holding-heart me-3 text-primary"></i>
        Szczegóły Darczyńcy
    </div>
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            --warning-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --info-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --danger-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --card-shadow: 0 10px 30px rgba(0,0,0,0.1);
            --card-hover-shadow: 0 20px 60px rgba(0,0,0,0.15);
        }

        .donor-header {
            background: var(--primary-gradient);
            border-radius: 24px;
            padding: 3rem 2rem;
            margin-bottom: 2rem;
            color: white;
            position: relative;
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }

        .donor-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -30%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            animation: float-bg 15s ease-in-out infinite;
        }

        @keyframes float-bg {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(-20px, -20px) rotate(180deg); }
        }

        .donor-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            border: 3px solid rgba(255,255,255,0.3);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .donor-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-hover-shadow);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin: 0 auto 1rem;
            color: white;
        }

        .stat-icon.total { background: var(--success-gradient); }
        .stat-icon.count { background: var(--info-gradient); }
        .stat-icon.average { background: var(--warning-gradient); }
        .stat-icon.rating { background: var(--danger-gradient); }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #718096;
            font-weight: 500;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .content-card {
            background: white;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            margin-bottom: 2rem;
            overflow: hidden;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .content-card:hover {
            box-shadow: var(--card-hover-shadow);
        }

        .card-header-custom {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 1.5rem 2rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .card-header-custom h5 {
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 600;
            color: #2d3748;
        }

        .card-body-custom {
            padding: 2rem;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .info-item {
            padding: 1rem;
            background: #f8fafc;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .info-label {
            font-size: 0.75rem;
            color: #718096;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }

        .info-value {
            font-size: 1rem;
            color: #2d3748;
            font-weight: 500;
        }

        .payment-timeline {
            position: relative;
            padding-left: 2rem;
        }

        .payment-timeline::before {
            content: '';
            position: absolute;
            left: 1rem;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #667eea, #764ba2);
        }

        .timeline-item {
            position: relative;
            padding-bottom: 2rem;
            margin-left: -1rem;
        }

        .timeline-marker {
            position: absolute;
            left: 0.75rem;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: white;
            border: 3px solid #667eea;
            top: 0.5rem;
        }

        .timeline-content {
            margin-left: 2rem;
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .payment-card {
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
        }

        .payment-card:hover {
            border-left-color: #764ba2;
            transform: translateX(5px);
        }

        .payment-status {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .payment-status.confirmed {
            background: #d4edda;
            color: #155724;
        }

        .payment-status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .payment-status.cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        .payment-method {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: #f8fafc;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            color: #4a5568;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        .btn-custom {
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            border: none;
            cursor: pointer;
            text-decoration: none;
        }

        .btn-primary-custom {
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-primary-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.6);
            color: white;
        }

        .btn-outline-custom {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-outline-custom:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .rating-stars {
            display: flex;
            gap: 0.25rem;
        }

        .rating-star {
            color: #ffd700;
            font-size: 1.25rem;
        }

        .rating-star.empty {
            color: #e2e8f0;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .donor-header {
                padding: 2rem 1.5rem;
            }

            .donor-stats {
                grid-template-columns: 1fr;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn-custom {
                justify-content: center;
            }
        }

        /* Dark mode support */
        [data-theme="dark"] .content-card {
            background: #2d3748;
            border-color: #4a5568;
        }

        [data-theme="dark"] .card-header-custom {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
        }

        [data-theme="dark"] .info-item {
            background: #4a5568;
            color: white;
        }

        [data-theme="dark"] .timeline-content {
            background: #2d3748;
            border-color: #4a5568;
        }
    </style>
{% endblock %}

{% block body %}
    <!-- Donor Header -->
    <div class="donor-header">
        <div class="row align-items-center">
            <div class="col-auto">
                <div class="donor-avatar">
                    <i class="fas fa-heart"></i>
                </div>
            </div>
            <div class="col">
                <h1 class="mb-2">{{ darczyca.pelneImieNazwisko }}</h1>
                <p class="mb-3 opacity-75">
                    <i class="fas fa-envelope me-2"></i>{{ darczyca.email }}
                    {% if darczyca.telefon %}
                        <i class="fas fa-phone ms-3 me-2"></i>{{ darczyca.telefon }}
                    {% endif %}
                </p>
                <div class="d-flex flex-wrap gap-2">
                    <span class="badge bg-{{ darczyca.statusBadge }} px-3 py-2">
                        <i class="fas fa-circle me-1"></i>
                        {{ darczyca.statusDarczyny|title }}
                    </span>
                    <span class="badge" style="background: rgba(255,255,255,0.2); color: white;" class="px-3 py-2">
                        <i class="fas fa-user-tag me-1"></i>
                        {{ darczyca.typDarczyny|replace({'_': ' '})|title }}
                    </span>
                </div>
            </div>
        </div>

        <!-- Stats Overview -->
        <div class="donor-stats">
            <div class="stat-card">
                <div class="stat-icon total">
                    <i class="fas fa-coins"></i>
                </div>
                <div class="stat-number">{{ darczyca.lacznaKwotaDotacji|number_format(2) }} zł</div>
                <div class="stat-label">Łączne Wsparcie</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon count">
                    <i class="fas fa-hashtag"></i>
                </div>
                <div class="stat-number">{{ darczyca.liczbaDotacji }}</div>
                <div class="stat-label">Liczba Dotacji</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon average">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="stat-number">{{ darczyca.srednieWsparcie|number_format(2) }} zł</div>
                <div class="stat-label">Średnie Wsparcie</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon rating">
                    <i class="fas fa-star"></i>
                </div>
                <div class="stat-number">
                    <div class="rating-stars">
                        {% for i in 1..5 %}
                            <i class="fas fa-star rating-star {{ i <= darczyca.ratingDarczyny ? '' : 'empty' }}"></i>
                        {% endfor %}
                    </div>
                </div>
                <div class="stat-label">Ocena Darczyńcy</div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Personal Information -->
        <div class="col-lg-4">
            <div class="content-card">
                <div class="card-header-custom">
                    <h5><i class="fas fa-user-circle text-primary"></i>Dane Osobowe</h5>
                </div>
                <div class="card-body-custom">
                    <div class="info-item mb-3">
                        <div class="info-label">Imię i Nazwisko</div>
                        <div class="info-value">{{ darczyca.imie }} {{ darczyca.nazwisko }}</div>
                    </div>
                    
                    {% if darczyca.firma %}
                    <div class="info-item mb-3">
                        <div class="info-label">Firma</div>
                        <div class="info-value">{{ darczyca.firma }}</div>
                    </div>
                    {% endif %}
                    
                    {% if darczyca.nip %}
                    <div class="info-item mb-3">
                        <div class="info-label">NIP</div>
                        <div class="info-value">{{ darczyca.nip }}</div>
                    </div>
                    {% endif %}
                    
                    {% if darczyca.dataUrodzenia %}
                    <div class="info-item mb-3">
                        <div class="info-label">Data Urodzenia</div>
                        <div class="info-value">{{ darczyca.dataUrodzenia|date('d.m.Y') }}</div>
                    </div>
                    {% endif %}
                    
                    <div class="info-item mb-3">
                        <div class="info-label">Data Rejestracji</div>
                        <div class="info-value">{{ darczyca.createdAt|date('d.m.Y H:i') }}</div>
                    </div>
                    
                    {% if darczyca.ostatniaInterakcja %}
                    <div class="info-item">
                        <div class="info-label">Ostatnia Interakcja</div>
                        <div class="info-value">{{ darczyca.ostatniaInterakcja|date('d.m.Y H:i') }}</div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Contact & Preferences -->
            <div class="content-card">
                <div class="card-header-custom">
                    <h5><i class="fas fa-address-book text-success"></i>Kontakt i Preferencje</h5>
                </div>
                <div class="card-body-custom">
                    <div class="info-item mb-3">
                        <div class="info-label">Email</div>
                        <div class="info-value">
                            <a href="mailto:{{ darczyca.email }}" class="text-decoration-none">
                                {{ darczyca.email }}
                            </a>
                        </div>
                    </div>
                    
                    {% if darczyca.telefon %}
                    <div class="info-item mb-3">
                        <div class="info-label">Telefon</div>
                        <div class="info-value">
                            <a href="tel:{{ darczyca.telefon }}" class="text-decoration-none">
                                {{ darczyca.telefon }}
                            </a>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if darczyca.adres %}
                    <div class="info-item mb-3">
                        <div class="info-label">Adres</div>
                        <div class="info-value">{{ darczyca.adres|nl2br }}</div>
                    </div>
                    {% endif %}
                    
                    <div class="info-item mb-3">
                        <div class="info-label">Preferencje Kontaktu</div>
                        <div class="info-value">{{ darczyca.preferencjeKontakt|title }}</div>
                    </div>
                    
                    <div class="d-flex gap-3 mt-3">
                        <span class="badge {{ darczyca.zgodaNaKontakt ? 'bg-success' : 'bg-danger' }} px-3 py-2">
                            <i class="fas fa-{{ darczyca.zgodaNaKontakt ? 'check' : 'times' }} me-1"></i>
                            {{ darczyca.zgodaNaKontakt ? 'Zgoda na kontakt' : 'Brak zgody' }}
                        </span>
                        <span class="badge {{ darczyca.zgodaNaNewsletter ? 'bg-info' : 'bg-secondary' }} px-3 py-2">
                            <i class="fas fa-envelope me-1"></i>
                            {{ darczyca.zgodaNaNewsletter ? 'Newsletter: TAK' : 'Newsletter: NIE' }}
                        </span>
                    </div>
                </div>
            </div>

            {% if darczyca.notatka %}
            <!-- Notes -->
            <div class="content-card">
                <div class="card-header-custom">
                    <h5><i class="fas fa-sticky-note text-warning"></i>Notatka</h5>
                </div>
                <div class="card-body-custom">
                    {{ darczyca.notatka|nl2br }}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Payment History -->
        <div class="col-lg-8">
            <div class="content-card">
                <div class="card-header-custom">
                    <h5>
                        <i class="fas fa-credit-card text-primary"></i>
                        Historia Płatności
                        <span class="badge bg-secondary ms-2">{{ darczyca.platnosci|length }} płatności</span>
                    </h5>
                </div>
                <div class="card-body-custom">
                    {% if darczyca.platnosci|length > 0 %}
                        <div class="payment-timeline">
                            {% for platnosc in darczyca.platnosci %}
                            <div class="timeline-item">
                                <div class="timeline-marker"></div>
                                <div class="timeline-content payment-card">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <div>
                                            <h6 class="mb-1">
                                                <strong class="text-success">{{ platnosc.kwota|number_format(2) }} {{ platnosc.waluta|default('PLN') }}</strong>
                                            </h6>
                                            <small class="text-muted">
                                                <i class="fas fa-calendar me-1"></i>
                                                {{ platnosc.dataIGodzina|date('d.m.Y H:i') }}
                                            </small>
                                        </div>
                                        <div class="text-end">
                                            <span class="payment-status {{ platnosc.statusPlatnosci }}">
                                                {{ platnosc.statusPlatnosci|title }}
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="row g-2 mb-2">
                                        {% if platnosc.metodaPlatnosci %}
                                        <div class="col-sm-6">
                                            <div class="payment-method">
                                                <i class="fas fa-{{ platnosc.metodaPlatnosci == 'card' ? 'credit-card' : (platnosc.metodaPlatnosci == 'transfer' ? 'university' : 'money-bill') }}"></i>
                                                {{ platnosc.metodaPlatnosci|title }}
                                            </div>
                                        </div>
                                        {% endif %}
                                        
                                        {% if platnosc.kategoriaWsparcia %}
                                        <div class="col-sm-6">
                                            <span class="badge bg-light text-dark">
                                                <i class="fas fa-tag me-1"></i>
                                                {{ platnosc.kategoriaWsparcia|title }}
                                            </span>
                                        </div>
                                        {% endif %}
                                    </div>
                                    
                                    {% if platnosc.numerPlatnosci %}
                                    <div class="small text-muted mb-1">
                                        <strong>Nr płatności:</strong> {{ platnosc.numerPlatnosci }}
                                    </div>
                                    {% endif %}
                                    
                                    {% if platnosc.numerReferencyjny %}
                                    <div class="small text-muted mb-1">
                                        <strong>Nr referencyjny:</strong> {{ platnosc.numerReferencyjny }}
                                    </div>
                                    {% endif %}
                                    
                                    {% if platnosc.bankNazwa %}
                                    <div class="small text-muted mb-1">
                                        <strong>Bank:</strong> {{ platnosc.bankNazwa }}
                                    </div>
                                    {% endif %}
                                    
                                    {% if platnosc.komunikatDlaOrganizacji %}
                                    <div class="mt-2 p-2 bg-light rounded">
                                        <small class="text-muted">
                                            <i class="fas fa-comment me-1"></i>
                                            <strong>Komunikat:</strong>
                                        </small>
                                        <br>
                                        <small>{{ platnosc.komunikatDlaOrganizacji }}</small>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-5">
                            <div class="mb-3">
                                <i class="fas fa-credit-card fa-3x text-muted"></i>
                            </div>
                            <h5 class="text-muted">Brak historii płatności</h5>
                            <p class="text-muted">Ten darczyńca nie ma jeszcze zarejestrowanych płatności.</p>
                            <button class="btn btn-primary-custom">
                                <i class="fas fa-plus me-2"></i>Dodaj płatność
                            </button>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
        <a href="{{ path('darczyca_edit', {id: darczyca.id}) }}" class="btn-custom btn-primary-custom">
            <i class="fas fa-edit"></i>
            Edytuj Darczyńcę
        </a>
        <a href="#" class="btn-custom btn-outline-custom" onclick="exportDonorData()">
            <i class="fas fa-download"></i>
            Eksportuj Dane
        </a>
        <a href="#" class="btn-custom btn-outline-custom" onclick="sendMessage()">
            <i class="fas fa-envelope"></i>
            Wyślij Wiadomość
        </a>
        <a href="{{ path('darczyca_index') }}" class="btn-custom btn-outline-custom">
            <i class="fas fa-arrow-left"></i>
            Powrót do Listy
        </a>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        function exportDonorData() {
            alert('Funkcja eksportu zostanie wkrótce dodana');
        }

        function sendMessage() {
            window.location.href = 'mailto:{{ darczyca.email }}';
        }

        // Initialize tooltips if available
        if (typeof bootstrap !== 'undefined') {
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        }
    </script>
{% endblock %}
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}CRM Nowa Nadzieja{% endblock %}</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'><text y='32' font-size='32'>⚫️</text></svg>">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="csrf-token" content="{{ csrf_token('app') }}">

    {% block stylesheets %}
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
        <link href="{{ asset('css/app.css') }}" rel="stylesheet">
        <link href="{{ asset('css/fixes.css') }}" rel="stylesheet">
        <link href="{{ asset('css/meeting-ui.css') }}" rel="stylesheet" type="text/css">
        
        <!-- JavaScript in head to avoid Turbo warnings -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="{{ asset('js/theme-toggle.js') }}"></script>
        <script src="{{ asset('js/lazy-loading.js') }}"></script>
        
        <style>
            /* Smooth transitions for theme changes */
            * {
                transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
            }
            
            /* CSS Variables for Theme Colors */
            :root {
                /* Light Mode Colors */
                --bg-primary: #ffffff;
                --bg-secondary: #f8f9fa;
                --bg-tertiary: #e9ecef;
                --text-primary: #212529;
                --text-secondary: #6c757d;
                --text-muted: #adb5bd;
                --border-color: #dee2e6;
                --shadow-light: rgba(0, 0, 0, 0.1);
                --shadow-medium: rgba(0, 0, 0, 0.15);
                --shadow-dark: rgba(0, 0, 0, 0.2);
                
                /* Sidebar Colors */
                --sidebar-bg-start: #1e40af;
                --sidebar-bg-end: #3b82f6;
                --sidebar-text: #ffffff;
                --sidebar-active-bg: rgba(255, 255, 255, 0.2);
                
                /* Brand Colors */
                --brand-primary: #1e40af;
                --brand-secondary: #3b82f6;
                --brand-accent: #60a5fa;
                
                /* Interactive Elements */
                --btn-hover-shadow: rgba(0, 0, 0, 0.15);
                --focus-ring: rgba(59, 130, 246, 0.25);
                --overlay-bg: rgba(255, 255, 255, 0.8);
            }

            /* Dark Mode Colors */
            [data-theme="dark"] {
                --bg-primary: #0f0f0f;
                --bg-secondary: #1a1a1a;
                --bg-tertiary: #2a2a2a;
                --text-primary: #ffffff;
                --text-secondary: #e0e0e0;
                --text-muted: #a8a8a8;
                --border-color: #333333;
                --shadow-light: rgba(0, 0, 0, 0.4);
                --shadow-medium: rgba(0, 0, 0, 0.6);
                --shadow-dark: rgba(0, 0, 0, 0.8);
                
                /* Sidebar Colors for Dark Mode */
                --sidebar-bg-start: #0a0e1a;
                --sidebar-bg-end: #1a2332;
                --sidebar-text: #f1f5f9;
                --sidebar-active-bg: rgba(59, 130, 246, 0.2);
                
                /* Brand Colors for Dark Mode */
                --brand-primary: #4f96ff;
                --brand-secondary: #64a8ff;
                --brand-accent: #7db8ff;
                
                /* Interactive Elements for Dark Mode */
                --btn-hover-shadow: rgba(0, 0, 0, 0.7);
                --focus-ring: rgba(79, 150, 255, 0.4);
                --overlay-bg: rgba(15, 15, 15, 0.9);
            }

            /* Global Styles */
            body {
                background-color: var(--bg-secondary);
                color: var(--text-primary);
                overflow-x: hidden;
                transition: background-color 0.3s ease, color 0.3s ease;
            }
            
            /* Force text visibility in dark mode - nuclear option */
            [data-theme="dark"] {
                color: var(--text-primary) !important;
            }
            
            [data-theme="dark"] * {
                color: inherit;
            }
            
            [data-theme="dark"] p,
            [data-theme="dark"] div,
            [data-theme="dark"] span,
            [data-theme="dark"] td,
            [data-theme="dark"] th,
            [data-theme="dark"] strong,
            [data-theme="dark"] b {
                color: var(--text-primary) !important;
            }

            /* Enhanced Sidebar Styles */
            .sidebar {
                background: linear-gradient(135deg, var(--sidebar-bg-start), var(--sidebar-bg-end));
                color: var(--sidebar-text);
                min-height: 100vh;
                transition: all 0.3s ease;
                box-shadow: 4px 0 20px rgba(0,0,0,0.1);
                position: relative;
                overflow: hidden;
            }
            
            .sidebar::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.05)"/><circle cx="50" cy="30" r="1.5" fill="rgba(255,255,255,0.05)"/><circle cx="80" cy="40" r="2.5" fill="rgba(255,255,255,0.05)"/><circle cx="30" cy="60" r="1" fill="rgba(255,255,255,0.05)"/><circle cx="70" cy="70" r="2" fill="rgba(255,255,255,0.05)"/><circle cx="40" cy="80" r="1.5" fill="rgba(255,255,255,0.05)"/></svg>');
                opacity: 0.3;
                pointer-events: none;
                animation: float 30s linear infinite;
            }

            .navbar-brand {
                font-weight: bold;
                color: var(--brand-primary) !important;
            }

            /* Enhanced Navigation Links */
            .sidebar .nav-link {
                color: var(--sidebar-text) !important;
                padding: 0.75rem 1rem;
                margin: 0.2rem 0;
                border-radius: 12px;
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
                backdrop-filter: blur(10px);
                border: 1px solid transparent;
            }
            
            .sidebar .nav-link::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
                transition: left 0.5s ease;
            }
            
            .sidebar .nav-link:hover::before {
                left: 100%;
            }
            
            .sidebar .nav-link:hover {
                background: rgba(255,255,255,0.1);
                transform: translateX(5px);
                border-color: rgba(255,255,255,0.2);
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            }
            
            .sidebar .nav-link.active {
                background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.1)) !important;
                border-color: rgba(255,255,255,0.3);
                box-shadow: 0 4px 20px rgba(0,0,0,0.15);
                transform: translateX(8px);
            }
            
            .sidebar .nav-link.active::after {
                content: '';
                position: absolute;
                right: -1px;
                top: 50%;
                transform: translateY(-50%);
                width: 4px;
                height: 60%;
                background: white;
                border-radius: 2px 0 0 2px;
            }
            
            .sidebar .nav-link i {
                width: 20px;
                text-align: center;
                margin-right: 0.75rem;
                font-size: 1.1rem;
                transition: transform 0.3s ease;
            }
            
            .sidebar .nav-link:hover i,
            .sidebar .nav-link.active i {
                transform: scale(1.1);
            }
            
            /* Enhanced Sidebar Logo */
            .sidebar-header {
                background: rgba(255,255,255,0.05);
                backdrop-filter: blur(20px);
                border-bottom: 1px solid rgba(255,255,255,0.1);
                position: relative;
                z-index: 2;
            }
            
            .sidebar-logo {
                position: relative;
            }
            
            .logo-icon {
                width: 60px;
                height: 60px;
                background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.1));
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0 auto 1rem;
                font-size: 2rem;
                color: white;
                box-shadow: 0 8px 24px rgba(0,0,0,0.15);
                border: 2px solid rgba(255,255,255,0.2);
                transition: all 0.3s ease;
            }
            
            .sidebar:hover .logo-icon {
                transform: scale(1.05);
                box-shadow: 0 12px 30px rgba(0,0,0,0.2);
            }
            
            .logo-text {
                font-size: 1.5rem;
                font-weight: 700;
                letter-spacing: 0.5px;
                text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            }
            
            .logo-subtitle {
                font-size: 0.75rem;
                letter-spacing: 0.3px;
                text-transform: uppercase;
                font-weight: 500;
            }
            
            /* Menu Sections */
            .menu-section {
                position: relative;
                z-index: 2;
            }
            
            .menu-section-title {
                font-size: 0.75rem;
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                color: rgba(255,255,255,0.7);
                padding: 0.5rem 1rem;
                margin-bottom: 0.5rem;
                display: flex;
                align-items: center;
                border-bottom: 1px solid rgba(255,255,255,0.1);
            }
            
            .menu-section-title i {
                font-size: 0.875rem;
            }
            
            /* Navigation Link Layout Updates */
            .sidebar .nav-link {
                display: flex;
                align-items: center;
                justify-content: flex-start;
                text-decoration: none;
            }
            
            .sidebar .nav-link span {
                flex: 1;
                font-weight: 500;
            }
            
            /* Submenu Styles */
            .has-submenu .submenu-icon {
                margin-left: auto;
                font-size: 0.8rem;
                transition: transform 0.3s ease;
            }
            
            .has-submenu .nav-link[aria-expanded="true"] .submenu-icon {
                transform: rotate(180deg);
            }
            
            .submenu {
                background: rgba(0,0,0,0.2);
                border-radius: 8px;
                margin: 0.5rem 0 0.5rem 1rem;
                padding: 0.5rem 0;
            }
            
            .submenu .nav-link {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
                border-left: 3px solid transparent;
                margin: 0.1rem 0.5rem;
            }
            
            .submenu .nav-link:hover {
                background: rgba(255,255,255,0.08);
                border-left-color: rgba(255,255,255,0.5);
                transform: translateX(3px);
            }
            
            .submenu .nav-link.active {
                background: rgba(255,255,255,0.15);
                border-left-color: white;
            }
            
            .submenu .nav-link i {
                font-size: 0.9rem;
                width: 18px;
            }
            
            /* Navigation Badges */
            .nav-badge {
                background: rgba(255,255,255,0.2);
                color: white;
                font-size: 0.625rem;
                font-weight: 600;
                padding: 0.25rem 0.5rem;
                border-radius: 10px;
                text-transform: uppercase;
                letter-spacing: 0.3px;
                margin-left: auto;
            }
            
            /* Logout Link Special Styling */
            .logout-link {
                border: 1px solid rgba(255,255,255,0.2) !important;
                background: rgba(220, 53, 69, 0.1) !important;
            }
            
            .logout-link:hover {
                background: rgba(220, 53, 69, 0.2) !important;
                border-color: rgba(220, 53, 69, 0.4) !important;
                transform: translateX(3px) !important;
            }
            
            /* Custom Scrollbar for Sidebar */
            .sidebar-menu {
                overflow-y: auto;
                max-height: calc(100vh - 160px);
                padding-bottom: 2rem;
            }
            
            .sidebar-menu::-webkit-scrollbar {
                width: 6px;
            }
            
            .sidebar-menu::-webkit-scrollbar-track {
                background: rgba(255,255,255,0.1);
                border-radius: 3px;
            }
            
            .sidebar-menu::-webkit-scrollbar-thumb {
                background: rgba(255,255,255,0.3);
                border-radius: 3px;
                transition: background 0.3s ease;
            }
            
            .sidebar-menu::-webkit-scrollbar-thumb:hover {
                background: rgba(255,255,255,0.5);
            }
            
            /* Sidebar Animation Effects */
            .sidebar .nav-link {
                animation: fadeInLeft 0.5s ease forwards;
                opacity: 0;
            }
            
            .sidebar .nav-link:nth-child(1) { animation-delay: 0.1s; }
            .sidebar .nav-link:nth-child(2) { animation-delay: 0.2s; }
            .sidebar .nav-link:nth-child(3) { animation-delay: 0.3s; }
            .sidebar .nav-link:nth-child(4) { animation-delay: 0.4s; }
            .sidebar .nav-link:nth-child(5) { animation-delay: 0.5s; }
            .sidebar .nav-link:nth-child(6) { animation-delay: 0.6s; }
            
            @keyframes fadeInLeft {
                from {
                    opacity: 0;
                    transform: translateX(-20px);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }
            
            /* Sidebar Footer */
            .sidebar-footer {
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                padding: 1rem;
                background: rgba(0,0,0,0.2);
                backdrop-filter: blur(10px);
                border-top: 1px solid rgba(255,255,255,0.1);
            }
            
            /* Sidebar Toggle Button */
            .sidebar-toggle-btn {
                background: rgba(255,255,255,0.1);
                border: 1px solid rgba(255,255,255,0.2);
                color: white;
                width: 40px;
                height: 40px;
                border-radius: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s ease;
                cursor: pointer;
                font-size: 1rem;
                backdrop-filter: blur(10px);
            }
            
            .sidebar-toggle-btn:hover {
                background: rgba(255,255,255,0.2);
                transform: scale(1.1);
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            }
            
            /* Additional collapsed state styles */
            
            .sidebar.collapsed .sidebar-header {
                padding: 1rem 0.5rem;
            }
            
            .sidebar.collapsed .logo-text,
            .sidebar.collapsed .logo-subtitle,
            .sidebar.collapsed .section-text,
            .sidebar.collapsed .nav-link span,
            .sidebar.collapsed .nav-badge {
                display: none;
            }
            
            .sidebar.collapsed .menu-section-title {
                justify-content: center;
                padding: 0.5rem;
            }
            
            .sidebar.collapsed .nav-link {
                justify-content: center;
                padding: 0.75rem;
            }
            
            .sidebar.collapsed .nav-link i {
                margin-right: 0;
            }
            
            .sidebar.collapsed .nav-link.active::after {
                display: none;
            }
            
            .sidebar.collapsed .sidebar-toggle-btn i {
                transform: rotate(180deg);
            }
            
            .sidebar.collapsed .sidebar-menu {
                padding: 0 0.5rem;
            }
            
            /* Tooltips for collapsed sidebar */
            .sidebar.collapsed .nav-link {
                position: relative;
            }
            
            .sidebar.collapsed .nav-link:hover::after {
                content: attr(data-tooltip);
                position: absolute;
                left: 100%;
                top: 50%;
                transform: translateY(-50%);
                background: rgba(0,0,0,0.9);
                color: white;
                padding: 0.5rem 1rem;
                border-radius: 8px;
                font-size: 0.875rem;
                white-space: nowrap;
                z-index: 1000;
                margin-left: 10px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            }
            
            .sidebar.collapsed .nav-link:hover::before {
                content: '';
                position: absolute;
                left: 100%;
                top: 50%;
                transform: translateY(-50%);
                border: 6px solid transparent;
                border-right-color: rgba(0,0,0,0.9);
                z-index: 1001;
                margin-left: 4px;
            }
            
            /* Enhanced Header Styles */
            .header-left {
                min-height: 60px;
            }
            
            /* Enhanced Hamburger Button */
            .hamburger-btn {
                width: 46px;
                height: 46px;
                background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
                border: none;
                border-radius: 12px;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                gap: 4px;
                transition: all 0.3s ease;
                box-shadow: 0 4px 12px rgba(30, 64, 175, 0.2);
                position: relative;
                overflow: hidden;
            }
            
            .hamburger-btn::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                transition: left 0.5s ease;
            }
            
            .hamburger-btn:hover::before {
                left: 100%;
            }
            
            .hamburger-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 16px rgba(30, 64, 175, 0.3);
            }
            
            .hamburger-btn:active {
                transform: translateY(0);
                box-shadow: 0 2px 8px rgba(30, 64, 175, 0.4);
            }
            
            .hamburger-line {
                width: 20px;
                height: 2px;
                background: white;
                border-radius: 1px;
                transition: all 0.3s ease;
                display: block;
            }
            
            .hamburger-btn.active .hamburger-line:first-child {
                transform: rotate(45deg) translate(5px, 5px);
            }
            
            .hamburger-btn.active .hamburger-line:nth-child(2) {
                opacity: 0;
            }
            
            .hamburger-btn.active .hamburger-line:last-child {
                transform: rotate(-45deg) translate(7px, -6px);
            }
            
            /* Header Navigation */
            .header-navigation {
                display: flex;
                align-items: center;
                justify-content: space-between;
            }
            
            .current-section {
                flex: 1;
            }
            
            .section-title {
                font-size: 1.75rem;
                font-weight: 700;
                color: var(--text-primary);
                margin: 0 0 0.25rem 0;
                line-height: 1.2;
            }
            
            .section-breadcrumb .breadcrumb {
                background: none;
                padding: 0;
                margin: 0;
                font-size: 0.875rem;
            }
            
            .section-breadcrumb .breadcrumb-item {
                color: var(--text-secondary);
            }
            
            .section-breadcrumb .breadcrumb-item + .breadcrumb-item::before {
                content: "›";
                color: var(--text-muted);
                font-weight: 600;
            }
            
            .section-breadcrumb .breadcrumb-item a {
                color: var(--brand-primary);
                transition: color 0.2s ease;
                font-weight: 500;
            }
            
            .section-breadcrumb .breadcrumb-item a:hover {
                color: var(--brand-secondary);
            }
            
            .section-breadcrumb .breadcrumb-item.active {
                color: var(--text-primary);
                font-weight: 600;
            }
            
            /* Enhanced Profile Section */
            .header-profile {
                margin-left: 2rem;
            }
            
            .profile-toggle {
                text-decoration: none !important;
                color: var(--text-primary) !important;
                transition: all 0.3s ease;
                border-radius: 12px;
                padding: 0.5rem;
                display: block;
            }
            
            .profile-toggle:hover {
                background: var(--bg-secondary);
                transform: translateY(-1px);
                box-shadow: 0 4px 12px var(--shadow-light);
            }
            
            .profile-info {
                display: flex;
                align-items: center;
                gap: 0.75rem;
            }
            
            .profile-avatar {
                width: 44px;
                height: 44px;
                border-radius: 50%;
                overflow: hidden;
                position: relative;
                border: 2px solid var(--border-color);
                transition: all 0.3s ease;
            }
            
            .profile-toggle:hover .profile-avatar {
                border-color: var(--brand-primary);
                transform: scale(1.05);
            }
            
            .profile-avatar img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            
            .avatar-placeholder {
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 1.2rem;
            }
            
            .profile-text {
                text-align: left;
                min-width: 120px;
            }
            
            .profile-name {
                font-weight: 600;
                font-size: 0.95rem;
                color: var(--text-primary);
                line-height: 1.2;
                margin-bottom: 0.125rem;
            }
            
            .profile-role {
                font-size: 0.8rem;
                color: var(--text-secondary);
                line-height: 1.2;
            }
            
            .profile-arrow {
                color: var(--text-muted);
                transition: transform 0.3s ease;
            }
            
            .profile-toggle[aria-expanded="true"] .profile-arrow {
                transform: rotate(180deg);
            }
            
            /* Profile Dropdown Menu */
            .profile-dropdown-menu {
                border: none;
                box-shadow: 0 8px 24px rgba(0,0,0,0.12);
                border-radius: 12px;
                padding: 0.5rem;
                margin-top: 0.5rem;
                min-width: 220px;
                background: var(--bg-primary);
                border: 1px solid var(--border-color);
            }
            
            .profile-dropdown-menu .dropdown-item {
                border-radius: 8px;
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
                transition: all 0.2s ease;
                display: flex;
                align-items: center;
                color: var(--text-primary);
                margin-bottom: 0.25rem;
            }
            
            .profile-dropdown-menu .dropdown-item:hover {
                background: var(--bg-secondary);
                color: var(--text-primary);
                transform: translateX(4px);
            }
            
            .profile-dropdown-menu .dropdown-item.text-danger {
                color: #dc3545 !important;
            }
            
            .profile-dropdown-menu .dropdown-item.text-danger:hover {
                background: rgba(220, 53, 69, 0.1);
                color: #dc3545 !important;
            }
            
            .profile-dropdown-menu .dropdown-divider {
                margin: 0.5rem 0;
                border-color: var(--border-color);
            }
            
            .profile-dropdown-menu .dropdown-item i {
                width: 16px;
                text-align: center;
            }

            /* Card Styles */
            .card {
                background-color: var(--bg-primary);
                color: var(--text-primary);
                box-shadow: 0 4px 6px -1px var(--shadow-light);
                border: 1px solid var(--border-color);
                transition: all 0.3s ease;
            }

            .card-header {
                background-color: var(--bg-secondary);
                border-bottom: 1px solid var(--border-color);
            }

            .card-footer {
                background-color: var(--bg-secondary);
                border-top: 1px solid var(--border-color);
            }

            /* Stats Cards */
            .stats-card {
                transition: transform 0.2s ease;
            }

            .stats-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 30px var(--shadow-dark);
            }

            /* Fixed Sidebar Layout */
            #sidebar {
                min-width: 250px;
                max-width: 250px;
                min-height: 100vh;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                position: fixed;
                top: 0;
                left: 0;
                z-index: 1040;
                will-change: transform, width, min-width, max-width;
            }

            #sidebar.active {
                transform: translateX(-250px);
            }
            
            /* Smooth transitions for collapsed state */
            #sidebar.collapsed {
                width: 80px;
                min-width: 80px;
                max-width: 80px;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            
            #sidebar .nav-link,
            #sidebar .menu-section-title,
            #sidebar .logo-text,
            #sidebar .logo-subtitle {
                transition: opacity 0.2s ease, transform 0.3s ease;
            }
            
            /* Main content adjustment for sidebar */
            #main-content {
                margin-left: 250px;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                width: calc(100% - 250px);
            }
            
            /* When sidebar is hidden (active), expand content to full width */
            body.sidebar-hidden #main-content {
                margin-left: 0;
                width: 100%;
            }
            
            /* When sidebar is collapsed, adjust content width */
            body.sidebar-collapsed #main-content {
                margin-left: 80px;
                width: calc(100% - 80px);
            }

            @media (max-width: 768px) {
                #sidebar {
                    position: fixed;
                    top: 0;
                    left: 0;
                    transform: translateX(-250px);
                    height: 100vh;
                    z-index: 1050;
                    box-shadow: 2px 0 10px rgba(0,0,0,0.3);
                }
                
                #main-content {
                    margin-left: 0 !important;
                    width: 100% !important;
                }
                
                body.sidebar-collapsed #main-content,
                body.sidebar-hidden #main-content {
                    margin-left: 0 !important;
                    width: 100% !important;
                }
                
                #sidebar.active {
                    transform: translateX(0);
                }
                
                #sidebar.show {
                    left: 0;
                    transform: translateX(0);
                }
                
                .sidebar-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.5);
                    z-index: 1040;
                    display: none;
                    transition: opacity 0.3s ease;
                }
                
                .sidebar-overlay.show {
                    display: block;
                    opacity: 1;
                }
                
                /* Mobile Bottom Navigation - REMOVED (using hamburger menu instead) */
                .mobile-bottom-nav {
                    display: none !important;
                }
                
                /* Mobile nav items - REMOVED (using hamburger menu instead) */
                
                /* Hide desktop sidebar on mobile */
                #content {
                    padding-bottom: 0; /* No space needed for bottom nav */
                    margin-left: 0;
                    width: 100%;
                }
                
                .d-flex {
                    display: block !important;
                }
                
                /* Enhanced Mobile Header */
                .mobile-header {
                    position: sticky;
                    top: 0;
                    background: linear-gradient(135deg, var(--bg-primary), rgba(255,255,255,0.95));
                    border-bottom: 1px solid var(--border-color);
                    z-index: 1030;
                    padding: 12px 16px;
                    margin: -16px -16px 16px -16px;
                    backdrop-filter: blur(20px);
                    -webkit-backdrop-filter: blur(20px);
                    box-shadow: 0 2px 12px rgba(0,0,0,0.05);
                }
                
                .mobile-title h2 {
                    font-size: 18px;
                    margin: 0;
                    font-weight: 700;
                    color: var(--text-primary);
                    text-align: center;
                }
                
                /* Enhanced Mobile Hamburger Button */
                .mobile-hamburger-btn {
                    width: 44px;
                    height: 44px;
                    background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
                    border: none;
                    border-radius: 12px;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    gap: 3px;
                    transition: all 0.3s ease;
                    box-shadow: 0 4px 12px rgba(30, 64, 175, 0.2);
                    touch-action: manipulation;
                    position: relative;
                    overflow: hidden;
                }
                
                .mobile-hamburger-btn::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: -100%;
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                    transition: left 0.5s ease;
                }
                
                .mobile-hamburger-btn:hover::before {
                    left: 100%;
                }
                
                .mobile-hamburger-btn:hover {
                    transform: translateY(-2px) scale(1.05);
                    box-shadow: 0 6px 16px rgba(30, 64, 175, 0.3);
                }
                
                .mobile-hamburger-btn:active {
                    transform: translateY(0) scale(0.95);
                    box-shadow: 0 2px 8px rgba(30, 64, 175, 0.4);
                }
                
                .mobile-hamburger-btn .hamburger-line {
                    width: 18px;
                    height: 2px;
                    background: white;
                    border-radius: 1px;
                    transition: all 0.3s ease;
                    display: block;
                }
                
                .mobile-hamburger-btn.active .hamburger-line:first-child {
                    transform: rotate(45deg) translate(4px, 4px);
                }
                
                .mobile-hamburger-btn.active .hamburger-line:nth-child(2) {
                    opacity: 0;
                }
                
                .mobile-hamburger-btn.active .hamburger-line:last-child {
                    transform: rotate(-45deg) translate(5px, -5px);
                }
                
                /* Enhanced Mobile Profile */
                .mobile-profile-link {
                    text-decoration: none;
                    display: block;
                    transition: all 0.3s ease;
                    border-radius: 50%;
                }
                
                .mobile-profile-link:hover {
                    transform: scale(1.1);
                }
                
                .mobile-profile-avatar {
                    width: 40px;
                    height: 40px;
                    border-radius: 50%;
                    overflow: hidden;
                    border: 2px solid var(--border-color);
                    transition: all 0.3s ease;
                }
                
                .mobile-profile-link:hover .mobile-profile-avatar {
                    border-color: var(--brand-primary);
                    box-shadow: 0 4px 12px rgba(30, 64, 175, 0.2);
                }
                
                .mobile-profile-avatar img {
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                }
                
                .mobile-avatar-placeholder {
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-size: 1.1rem;
                }
                
                /* Profile info mobile */
                .profile-link {
                    font-size: 14px;
                    padding: 8px 12px;
                    border-radius: 10px;
                    transition: all 0.3s ease;
                    background: var(--bg-secondary);
                    border: 1px solid var(--border-color);
                }
                
                .profile-link:hover {
                    background: var(--bg-tertiary);
                    transform: none;
                }
                
                .profile-link img,
                .profile-link i {
                    width: 32px;
                    height: 32px;
                }
            }
            
            /* Hide mobile nav on desktop - REMOVED */
            @media (min-width: 769px) {
            }
            
            /* Global Mobile Improvements */
            @media (max-width: 768px) {
                /* Container padding */
                .container, .container-fluid {
                    padding-left: 16px;
                    padding-right: 16px;
                }
                
                /* Card improvements */
                .card {
                    border-radius: 16px;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
                    margin-bottom: 20px;
                    border: 1px solid var(--border-color);
                    overflow: hidden;
                }
                
                [data-theme="dark"] .card {
                    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                }
                
                .card-header {
                    padding: 20px;
                    border-bottom: 1px solid var(--border-color);
                    background: var(--bg-secondary);
                }
                
                .card-body {
                    padding: 24px 20px;
                }
                
                .card-title {
                    font-size: 18px;
                    margin-bottom: 8px;
                }
                
                /* Button improvements */
                .btn {
                    min-height: 48px;
                    font-size: 16px;
                    border-radius: 12px;
                    padding: 14px 24px;
                    touch-action: manipulation;
                    font-weight: 500;
                    transition: all 0.3s ease;
                    position: relative;
                    overflow: hidden;
                }
                
                .btn:active {
                    transform: scale(0.96);
                }
                
                .btn-sm {
                    min-height: 36px;
                    font-size: 14px;
                    padding: 8px 16px;
                }
                
                .btn-lg {
                    min-height: 52px;
                    font-size: 18px;
                    padding: 16px 24px;
                }
                
                /* Form improvements */
                .form-control, .form-select {
                    min-height: 52px;
                    font-size: 16px;
                    border-radius: 12px;
                    border: 2px solid var(--border-color);
                    padding: 14px 18px;
                    background: var(--bg-primary);
                    color: var(--text-primary);
                    transition: all 0.3s ease;
                }
                
                .form-control:focus, .form-select:focus {
                    border-color: var(--brand-primary);
                    box-shadow: 0 0 0 4px rgba(30, 64, 175, 0.15);
                    background: var(--bg-primary);
                    color: var(--text-primary);
                    outline: none;
                }
                
                .form-label {
                    font-weight: 600;
                    margin-bottom: 8px;
                    font-size: 14px;
                    color: var(--text-primary);
                }
                
                textarea.form-control {
                    min-height: 120px;
                    resize: vertical;
                }
                
                /* Table responsive */
                .table-responsive {
                    border-radius: 12px;
                    box-shadow: 0 2px 12px rgba(0,0,0,0.1);
                    overflow-x: auto;
                    -webkit-overflow-scrolling: touch;
                }
                
                [data-theme="dark"] .table-responsive {
                    box-shadow: 0 2px 12px rgba(0,0,0,0.3);
                }
                
                .table th {
                    font-size: 13px;
                    font-weight: 600;
                    padding: 16px 12px;
                    border-bottom: 2px solid var(--border-color);
                    background: var(--bg-secondary);
                    white-space: nowrap;
                }
                
                .table td {
                    font-size: 14px;
                    padding: 16px 12px;
                    border-bottom: 1px solid var(--border-color);
                    vertical-align: middle;
                }
                
                /* Alert improvements */
                .alert {
                    border-radius: 8px;
                    padding: 16px;
                    font-size: 15px;
                    border-width: 1px;
                    margin-bottom: 16px;
                }
                
                /* Badge improvements */
                .badge {
                    font-size: 12px;
                    padding: 6px 12px;
                    border-radius: 20px;
                    font-weight: 500;
                }
                
                /* Modal improvements */
                .modal-header {
                    padding: 20px 20px 16px;
                    border-bottom: 1px solid var(--border-color);
                }
                
                .modal-body {
                    padding: 20px;
                }
                
                .modal-footer {
                    padding: 16px 20px 20px;
                    border-top: 1px solid var(--border-color);
                }
                
                /* List group improvements */
                .list-group-item {
                    padding: 16px 20px;
                    border: 1px solid var(--border-color);
                    font-size: 15px;
                }
                
                .list-group-item:first-child {
                    border-top-left-radius: 8px;
                    border-top-right-radius: 8px;
                }
                
                .list-group-item:last-child {
                    border-bottom-left-radius: 8px;
                    border-bottom-right-radius: 8px;
                }
                
                /* Breadcrumb improvements */
                .breadcrumb {
                    background: none;
                    padding: 0;
                    margin-bottom: 16px;
                }
                
                .breadcrumb-item {
                    font-size: 14px;
                }
                
                .breadcrumb-item + .breadcrumb-item::before {
                    color: var(--text-muted);
                }
                
                /* Dropdown improvements */
                .dropdown-menu {
                    border-radius: 12px;
                    box-shadow: 0 8px 24px rgba(0,0,0,0.15);
                    border: 1px solid var(--border-color);
                    padding: 8px;
                }
                
                .dropdown-item {
                    border-radius: 6px;
                    padding: 12px 16px;
                    font-size: 15px;
                    margin-bottom: 2px;
                }
                
                .dropdown-item:hover,
                .dropdown-item:focus {
                    background-color: var(--bg-tertiary);
                }
                
                /* Pagination improvements */
                .pagination {
                    margin-bottom: 16px;
                }
                
                .page-link {
                    padding: 12px 16px;
                    font-size: 14px;
                    border-radius: 8px;
                    margin: 0 2px;
                    border: 1px solid var(--border-color);
                }
                
                /* Progress bar improvements */
                .progress {
                    height: 8px;
                    border-radius: 10px;
                    background-color: var(--bg-tertiary);
                }
                
                .progress-bar {
                    border-radius: 10px;
                }
                
                /* Spinner improvements */
                .spinner-border {
                    width: 2rem;
                    height: 2rem;
                }
                
                /* Typography improvements */
                h1 { font-size: 28px; line-height: 1.2; }
                h2 { font-size: 24px; line-height: 1.2; }
                h3 { font-size: 20px; line-height: 1.3; }
                h4 { font-size: 18px; line-height: 1.3; }
                h5 { font-size: 16px; line-height: 1.4; }
                h6 { font-size: 14px; line-height: 1.4; }
                
                /* Touch target improvements */
                a, button, .btn, .nav-link, .dropdown-item {
                    touch-action: manipulation;
                }
                
                /* Prevent zoom on input focus (iOS) */
                input[type="text"],
                input[type="email"], 
                input[type="password"],
                input[type="number"],
                input[type="tel"],
                input[type="url"],
                input[type="search"],
                input[type="date"],
                input[type="datetime-local"],
                input[type="time"],
                select,
                textarea {
                    font-size: 16px;
                }
                
                /* Enhanced touch targets */
                .btn, .nav-link, .dropdown-item, .page-link {
                    min-height: 44px;
                    display: flex;
                    align-items: center;
                }
                
                /* Mobile-specific improvements */
                .mobile-enhanced-card {
                    border-radius: 12px;
                    box-shadow: 0 2px 12px rgba(0,0,0,0.08);
                    transition: all 0.2s ease;
                    position: relative;
                    overflow: hidden;
                }
                
                .mobile-enhanced-card::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: -100%;
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(90deg, transparent, rgba(30, 64, 175, 0.1), transparent);
                    transition: left 0.5s ease;
                }
                
                .mobile-enhanced-card:active::before {
                    left: 100%;
                }
                
                .mobile-enhanced-card:active {
                    transform: scale(0.98);
                }
                
                /* Improved mobile navigation */
                .mobile-nav-item {
                    position: relative;
                    overflow: hidden;
                }
                
                .mobile-nav-item::after {
                    content: '';
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    width: 0;
                    height: 0;
                    border-radius: 50%;
                    background: rgba(255, 255, 255, 0.3);
                    transform: translate(-50%, -50%);
                    transition: width 0.3s ease, height 0.3s ease;
                }
                
                .mobile-nav-item:active::after {
                    width: 100px;
                    height: 100px;
                }
                
                /* Better mobile form controls */
                .mobile-form-group {
                    margin-bottom: 1.5rem;
                }
                
                .mobile-form-group .form-label {
                    font-weight: 600;
                    margin-bottom: 0.75rem;
                    color: var(--text-primary);
                }
                
                .mobile-form-control {
                    min-height: 52px;
                    font-size: 16px; /* Prevents iOS zoom */
                    border: 2px solid var(--border-color);
                    border-radius: 8px;
                    padding: 14px 16px;
                    transition: all 0.3s ease;
                    background: var(--bg-primary);
                }
                
                .mobile-form-control:focus {
                    border-color: var(--brand-primary);
                    box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
                    transform: translateY(-1px);
                }
                
                /* Swipe indicators */
                .swipe-hint {
                    position: absolute;
                    top: 50%;
                    right: 16px;
                    transform: translateY(-50%);
                    color: var(--text-muted);
                    font-size: 12px;
                    opacity: 0.7;
                    animation: swipe-pulse 2s infinite;
                }
                
                @keyframes swipe-pulse {
                    0%, 100% { opacity: 0.7; transform: translateY(-50%) translateX(0); }
                    50% { opacity: 1; transform: translateY(-50%) translateX(-4px); }
                }
                
                /* Improved scrolling */
                .table-responsive {
                    scroll-behavior: smooth;
                }
                
                /* Better focus indicators */
                .btn:focus,
                .nav-link:focus,
                .form-control:focus,
                .form-select:focus {
                    outline: 2px solid var(--brand-primary);
                    outline-offset: 2px;
                }
                
                /* Smooth animations */
                * {
                    scroll-behavior: smooth;
                }
            }

            /* Profile Link */
            .profile-link {
                transition: all 0.3s ease;
                border-radius: 0.375rem;
                padding: 0.5rem;
                color: var(--text-primary) !important;
            }

            .profile-link:hover {
                background-color: var(--bg-tertiary);
                color: var(--brand-primary) !important;
                transform: translateY(-1px);
            }

            /* Buttons */
            .btn {
                border-radius: 0.375rem;
                font-weight: 500;
                transition: all 0.2s ease;
            }

            .btn:hover {
                transform: translateY(-1px);
                box-shadow: 0 4px 8px var(--btn-hover-shadow);
            }

            /* Form Controls */
            .form-control, .form-select {
                background-color: var(--bg-primary);
                border-color: var(--border-color);
                color: var(--text-primary);
                transition: all 0.3s ease;
            }

            .form-control:focus, .form-select:focus {
                background-color: var(--bg-primary);
                border-color: var(--brand-secondary);
                color: var(--text-primary);
                box-shadow: 0 0 0 0.2rem var(--focus-ring);
            }

            /* Hover Effects */
            .card:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px var(--shadow-medium);
            }

            /* Loading Spinner */
            .spinner-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: var(--overlay-bg);
                display: none;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                transition: all 0.3s ease;
            }

            .spinner-overlay.show {
                display: flex;
            }

            /* Theme Toggle */
            .theme-toggle {
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 1050;
                background: var(--bg-primary);
                border: 2px solid var(--border-color);
                border-radius: 50%;
                width: 50px;
                height: 50px;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 2px 10px var(--shadow-light);
            }

            .theme-toggle:hover {
                transform: scale(1.1);
                box-shadow: 0 4px 15px var(--shadow-medium);
            }

            /* Dark mode specific adjustments */
            [data-theme="dark"] .table {
                --bs-table-bg: var(--bg-primary);
                --bs-table-striped-bg: var(--bg-tertiary);
                --bs-table-color: var(--text-primary);
                color: var(--text-primary) !important;
                border-color: var(--border-color);
            }
            
            [data-theme="dark"] .table td,
            [data-theme="dark"] .table th {
                color: var(--text-primary) !important;
                border-color: var(--border-color) !important;
            }
            
            [data-theme="dark"] .table tbody tr td {
                color: var(--text-primary) !important;
            }
            
            [data-theme="dark"] .table strong {
                color: var(--text-primary) !important;
            }

            [data-theme="dark"] .table > :not(caption) > * > * {
                border-bottom-color: var(--border-color);
            }

            [data-theme="dark"] .table-hover tbody tr:hover {
                --bs-table-hover-bg: var(--bg-tertiary);
                color: var(--text-primary);
            }

            [data-theme="dark"] .alert {
                background-color: var(--bg-secondary);
                border-color: var(--border-color);
                color: var(--text-primary);
            }

            [data-theme="dark"] .alert-success {
                background-color: rgba(34, 197, 94, 0.1);
                border-color: rgba(34, 197, 94, 0.3);
                color: #4ade80;
            }

            [data-theme="dark"] .alert-danger {
                background-color: rgba(239, 68, 68, 0.1);
                border-color: rgba(239, 68, 68, 0.3);
                color: #f87171;
            }

            [data-theme="dark"] .alert-warning {
                background-color: rgba(245, 158, 11, 0.1);
                border-color: rgba(245, 158, 11, 0.3);
                color: #fbbf24;
            }

            [data-theme="dark"] .alert-info {
                background-color: rgba(59, 130, 246, 0.1);
                border-color: rgba(59, 130, 246, 0.3);
                color: #60a5fa;
            }

            [data-theme="dark"] .badge {
                background-color: var(--brand-secondary) !important;
                color: #ffffff !important;
            }

            [data-theme="dark"] .border {
                border-color: var(--border-color) !important;
            }

            [data-theme="dark"] .text-muted {
                color: var(--text-muted) !important;
            }
            
            [data-theme="dark"] small.text-muted {
                color: var(--text-secondary) !important;
            }
            
            [data-theme="dark"] .badge.bg-secondary {
                background-color: #6c757d !important;
                color: #ffffff !important;
            }
            
            [data-theme="dark"] .btn-outline-primary {
                color: var(--brand-primary);
                border-color: var(--brand-primary);
            }
            
            [data-theme="dark"] .btn-outline-primary:hover {
                background-color: var(--brand-primary);
                border-color: var(--brand-primary);
                color: #ffffff;
            }
            
            [data-theme="dark"] .btn-outline-secondary {
                color: var(--text-secondary);
                border-color: var(--border-color);
            }
            
            [data-theme="dark"] .btn-outline-secondary:hover {
                background-color: var(--bg-tertiary);
                border-color: var(--border-color);
                color: var(--text-primary);
            }
            
            [data-theme="dark"] .btn-outline-info {
                color: #17a2b8;
                border-color: #17a2b8;
            }
            
            [data-theme="dark"] .btn-outline-info:hover {
                background-color: #17a2b8;
                border-color: #17a2b8;
                color: #ffffff;
            }

            [data-theme="dark"] .dropdown-menu {
                background-color: var(--bg-primary);
                border-color: var(--border-color);
            }

            [data-theme="dark"] .dropdown-item {
                color: var(--text-primary);
            }

            [data-theme="dark"] .dropdown-item:hover {
                background-color: var(--bg-tertiary);
                color: var(--text-primary);
            }

            [data-theme="dark"] .modal-content {
                background-color: var(--bg-primary);
                border-color: var(--border-color);
            }

            [data-theme="dark"] .modal-header {
                border-bottom-color: var(--border-color);
            }

            [data-theme="dark"] .modal-footer {
                border-top-color: var(--border-color);
            }

            [data-theme="dark"] .list-group-item {
                background-color: var(--bg-primary);
                border-color: var(--border-color);
                color: var(--text-primary);
            }

            [data-theme="dark"] .list-group-item:hover {
                background-color: var(--bg-tertiary);
            }
            
            /* Pagination styling for dark mode */
            [data-theme="dark"] .pagination .page-link {
                background-color: var(--bg-primary);
                border-color: var(--border-color);
                color: var(--text-primary);
            }
            
            [data-theme="dark"] .pagination .page-link:hover {
                background-color: var(--bg-tertiary);
                border-color: var(--border-color);
                color: var(--text-primary);
            }
            
            [data-theme="dark"] .pagination .page-item.active .page-link {
                background-color: var(--brand-primary);
                border-color: var(--brand-primary);
                color: #ffffff;
            }
            
            [data-theme="dark"] .pagination .page-item.disabled .page-link {
                background-color: var(--bg-secondary);
                border-color: var(--border-color);
                color: var(--text-muted);
            }
            
            /* Better visibility for empty state text */
            [data-theme="dark"] .text-center .text-muted {
                color: var(--text-secondary) !important;
            }
            
            /* Badge improvements */
            [data-theme="dark"] .badge.bg-info {
                background-color: #0dcaf0 !important;
                color: #000000 !important;
            }
            
            [data-theme="dark"] .badge.bg-success {
                background-color: #198754 !important;
                color: #ffffff !important;
            }
            
            [data-theme="dark"] .badge.bg-warning {
                background-color: #ffc107 !important;
                color: #000000 !important;
            }
            
            /* Force text visibility in all common elements */
            [data-theme="dark"] .card-body {
                color: var(--text-primary) !important;
            }
            
            [data-theme="dark"] .card-body * {
                color: inherit;
            }
            
            [data-theme="dark"] .card-body .text-muted {
                color: var(--text-secondary) !important;
            }
            
            [data-theme="dark"] .card-body small.text-muted {
                color: var(--text-secondary) !important;
            }
            
            [data-theme="dark"] label.form-label {
                color: var(--text-primary) !important;
            }
            
            [data-theme="dark"] h4, 
            [data-theme="dark"] h5 {
                color: var(--text-primary) !important;
            }
            
            /* Fix any remaining Bootstrap text classes */
            [data-theme="dark"] .text-dark {
                color: var(--text-primary) !important;
            }
            
            [data-theme="dark"] .text-secondary {
                color: var(--text-secondary) !important;
            }
            
            /* Form elements in dark mode */
            [data-theme="dark"] .form-control,
            [data-theme="dark"] .form-select {
                background-color: var(--bg-secondary) !important;
                border-color: #495057 !important;
                color: var(--text-primary) !important;
            }
            
            [data-theme="dark"] .form-control:focus,
            [data-theme="dark"] .form-select:focus {
                background-color: var(--bg-secondary) !important;
                border-color: var(--accent-primary) !important;
                box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25) !important;
                color: var(--text-primary) !important;
            }
            
            [data-theme="dark"] .form-control::placeholder {
                color: var(--text-secondary) !important;
                opacity: 0.7;
            }
            
            [data-theme="dark"] .form-check-input {
                background-color: var(--bg-secondary) !important;
                border-color: #495057 !important;
            }
            
            [data-theme="dark"] .form-check-input:checked {
                background-color: var(--accent-primary) !important;
                border-color: var(--accent-primary) !important;
            }
            
            [data-theme="dark"] .input-group-text {
                background-color: var(--bg-secondary) !important;
                border-color: #495057 !important;
                color: var(--text-primary) !important;
            }

            /* Enhanced Breadcrumb Styling */
            .breadcrumb {
                background: none;
                padding: 0;
                margin: 0;
                font-size: 14px;
            }
            
            .breadcrumb-item + .breadcrumb-item::before {
                content: "›";
                color: var(--text-muted);
                font-weight: bold;
            }
            
            .breadcrumb-item a {
                color: var(--brand-primary);
                transition: color 0.2s ease;
            }
            
            .breadcrumb-item a:hover {
                color: var(--brand-secondary);
                text-decoration: underline !important;
            }
            
            .breadcrumb-item.active {
                color: var(--text-primary);
                font-weight: 500;
            }

            /* Political Context - Official Document Styling */
            .official-document-form {
                border: 2px solid var(--brand-primary);
                background: linear-gradient(145deg, rgba(30, 64, 175, 0.02), rgba(59, 130, 246, 0.02));
                border-radius: 8px;
                position: relative;
                padding: 1.5rem;
            }

            .official-document-form::before {
                content: "DOKUMENT OFICJALNY";
                position: absolute;
                top: -12px;
                left: 20px;
                background: var(--bg-primary);
                padding: 0 10px;
                font-size: 11px;
                font-weight: 600;
                color: var(--brand-primary);
                letter-spacing: 0.5px;
            }

            .official-document-header {
                text-align: center;
                padding: 1rem 0;
                border-bottom: 2px solid var(--brand-primary);
                margin-bottom: 1.5rem;
            }

            .official-document-header .party-name {
                font-size: 1.5rem;
                font-weight: 700;
                color: var(--brand-primary);
                margin-bottom: 0.5rem;
            }

            .official-document-header .document-type {
                font-size: 1rem;
                color: var(--text-secondary);
                font-weight: 500;
            }

            /* Status Indicators Enhancement */
            .member-status-badge {
                padding: 6px 12px;
                border-radius: 6px;
                font-size: 12px;
                font-weight: 600;
                letter-spacing: 0.3px;
                text-transform: uppercase;
                border: 2px solid transparent;
            }

            .member-status-badge.status-active {
                background: rgba(34, 197, 94, 0.1);
                color: #059669;
                border-color: rgba(34, 197, 94, 0.2);
            }

            .member-status-badge.status-inactive {
                background: rgba(156, 163, 175, 0.1);
                color: #6b7280;
                border-color: rgba(156, 163, 175, 0.2);
            }

            .member-status-badge.status-suspended {
                background: rgba(245, 158, 11, 0.1);
                color: #d97706;
                border-color: rgba(245, 158, 11, 0.2);
            }

            /* Professional Table Enhancements */
            .professional-table {
                border: 1px solid var(--border-color);
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            }

            .professional-table .table-header {
                background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
                color: white;
                font-weight: 600;
                font-size: 14px;
                letter-spacing: 0.3px;
            }

            .professional-table .table-header th {
                border: none;
                padding: 1rem 0.75rem;
                text-align: center;
            }

            .professional-table tbody tr:nth-child(even) {
                background: rgba(30, 64, 175, 0.02);
            }

            .professional-table tbody tr:hover {
                background: rgba(30, 64, 175, 0.05);
                transform: none;
            }

            /* Accessibility Improvements */
            .skip-link {
                position: absolute;
                top: -40px;
                left: 6px;
                background: var(--brand-primary);
                color: white;
                padding: 8px 16px;
                border-radius: 0 0 4px 4px;
                text-decoration: none;
                font-weight: 600;
                z-index: 2000;
                transform: translateY(-100%);
                transition: transform 0.3s ease;
            }

            .skip-link:focus {
                transform: translateY(0);
                color: white;
                text-decoration: none;
            }

            /* Enhanced Focus Indicators */
            .focus-enhanced:focus-visible,
            .btn:focus-visible,
            .nav-link:focus-visible,
            .form-control:focus-visible,
            .form-select:focus-visible,
            a:focus-visible {
                outline: 3px solid var(--brand-primary);
                outline-offset: 2px;
                box-shadow: 0 0 0 1px var(--bg-primary);
                border-radius: 4px;
            }

            /* Reduce motion for accessibility */
            @media (prefers-reduced-motion: reduce) {
                .skip-link {
                    transition: none;
                }
                
                .mobile-enhanced-card::before {
                    display: none;
                }
                
                .swipe-hint {
                    animation: none;
                }
            }

            /* High contrast mode support */
            @media (prefers-contrast: high) {
                .stats-card-enhanced {
                    border: 3px solid var(--brand-primary);
                }
                
                .member-status-badge {
                    border-width: 2px;
                }
                
                .breadcrumb-item a {
                    text-decoration: underline;
                }
            }

            /* Smooth transitions for theme changes */
            * {
                transition: background-color 0.3s cubic-bezier(0.4, 0, 0.2, 1), 
                           color 0.3s cubic-bezier(0.4, 0, 0.2, 1), 
                           border-color 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                           transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                           box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            
            /* Reduce motion for users who prefer it */
            @media (prefers-reduced-motion: reduce) {
                * {
                    transition: none !important;
                    animation: none !important;
                }
            }

            /* Animation for theme toggle icon */
            .theme-toggle i {
                transition: transform 0.3s ease;
            }

            .theme-toggle:hover i {
                transform: rotate(180deg);
            }

            /* Enhanced Mobile Responsiveness */
            @media (max-width: 576px) {
                /* Stats cards on mobile - 2 per row */
                .stats-card-mobile {
                    margin-bottom: 1rem;
                }

                /* Compact cards for mobile */
                .stats-card .card-body {
                    padding: 1rem;
                }

                .stats-card i {
                    font-size: 1.5rem;
                }

                .stats-card h4 {
                    font-size: 1.5rem;
                    margin-bottom: 0.25rem;
                }

                .stats-card .card-text {
                    font-size: 0.875rem;
                }

                /* Better mobile tables */
                .table-responsive {
                    border-radius: 8px;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                }

                .table-mobile th {
                    font-size: 0.75rem;
                    padding: 0.5rem 0.25rem;
                }

                .table-mobile td {
                    font-size: 0.875rem;
                    padding: 0.5rem 0.25rem;
                }

                /* Mobile action buttons */
                .btn-group-vertical-mobile .btn {
                    margin-bottom: 0.5rem;
                    width: 100%;
                }

                /* Compact pagination */
                .pagination-sm .page-link {
                    padding: 0.375rem 0.5rem;
                    font-size: 0.75rem;
                }

                /* Mobile filters - collapsible by default */
                .filter-card-mobile {
                    margin-bottom: 1rem;
                }

                .filter-card-mobile .card-body {
                    padding: 1rem;
                }

                .filter-row-mobile .col {
                    margin-bottom: 0.75rem;
                }

                /* Touch-friendly inputs */
                .form-control-mobile {
                    min-height: 44px;
                    font-size: 16px; /* Prevents zoom on iOS */
                }

                .btn-mobile {
                    min-height: 44px;
                    padding: 0.75rem 1rem;
                }

                /* Compact alerts */
                .alert-mobile {
                    padding: 0.75rem;
                    font-size: 0.875rem;
                }
            }

            @media (max-width: 768px) and (orientation: landscape) {
                /* Landscape phone optimizations */

                .mobile-nav-icon {
                    font-size: 18px;
                    margin-bottom: 2px;
                }

                .mobile-nav-label {
                    font-size: 9px;
                }

                #content {
                    padding-bottom: 70px;
                }
            }

            /* Tablet improvements */
            @media (min-width: 769px) and (max-width: 1024px) {
                .stats-card {
                    margin-bottom: 1.5rem;
                }

                .table th, .table td {
                    padding: 0.75rem 0.5rem;
                    font-size: 0.9rem;
                }

                .btn-group .btn {
                    padding: 0.5rem 0.75rem;
                    font-size: 0.875rem;
                }
            }

            /* Swipe gestures hint */
            .swipe-hint {
                position: relative;
                overflow: hidden;
            }

            .swipe-hint::after {
                content: '← Przesuń →';
                position: absolute;
                top: 50%;
                right: 10px;
                transform: translateY(-50%);
                font-size: 0.75rem;
                color: var(--text-muted);
                opacity: 0.7;
                animation: pulse 2s infinite;
                pointer-events: none;
            }

            @keyframes pulse {
                0%, 100% { opacity: 0.7; }
                50% { opacity: 0.3; }
            }

            /* Hide swipe hint on desktop */
            @media (min-width: 769px) {
                .swipe-hint::after {
                    display: none;
                }
            }

            /* Improved focus states for mobile */
            @media (max-width: 768px) {
                .btn:focus,
                .form-control:focus,
                .nav-link:focus {
                    outline: 3px solid var(--brand-primary);
                    outline-offset: 2px;
                    box-shadow: none;
                }

                /* Larger touch targets */
                .btn-sm {
                    min-height: 40px;
                    min-width: 40px;
                }

                .pagination .page-link {
                    min-height: 44px;
                    min-width: 44px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
            }

            /* ========== ENHANCED VISUAL IMPROVEMENTS ========== */
            
            /* Loading States */
            .loading-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: var(--overlay-bg);
                backdrop-filter: blur(4px);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
            }
            
            .loading-overlay.show {
                opacity: 1;
                visibility: visible;
            }
            
            .loading-spinner {
                width: 60px;
                height: 60px;
                border: 4px solid var(--border-color);
                border-top: 4px solid var(--brand-primary);
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin-bottom: 1rem;
            }
            
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            
            .loading-text {
                color: var(--text-primary);
                font-weight: 500;
                text-align: center;
            }
            
            /* Enhanced Toast Notifications */
            .toast-container {
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 9998;
            }
            
            .toast-enhanced {
                min-width: 350px;
                border: none;
                border-radius: 12px;
                box-shadow: 0 8px 32px rgba(0,0,0,0.15);
                backdrop-filter: blur(10px);
                animation: slideInRight 0.3s ease;
                margin-bottom: 10px;
            }
            
            .toast-enhanced.success {
                background: linear-gradient(135deg, #22c55e, #16a34a);
                color: white;
            }
            
            .toast-enhanced.error {
                background: linear-gradient(135deg, #ef4444, #dc2626);
                color: white;
            }
            
            .toast-enhanced.warning {
                background: linear-gradient(135deg, #f59e0b, #d97706);
                color: white;
            }
            
            .toast-enhanced.info {
                background: linear-gradient(135deg, #3b82f6, #1d4ed8);
                color: white;
            }
            
            @keyframes slideInRight {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            /* Enhanced Button Styles */
            .btn-enhanced {
                position: relative;
                overflow: hidden;
                transition: all 0.3s ease;
                border-radius: 8px;
                font-weight: 500;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            }
            
            .btn-enhanced::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                transition: left 0.5s;
            }
            
            .btn-enhanced:hover::before {
                left: 100%;
            }
            
            .btn-enhanced:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 16px rgba(0,0,0,0.2);
            }
            
            .btn-enhanced:active {
                transform: translateY(0);
            }
            
            /* Enhanced Cards */
            .card-enhanced {
                border: none;
                border-radius: 16px;
                box-shadow: 0 4px 16px rgba(0,0,0,0.08);
                transition: all 0.3s ease;
                background: var(--bg-primary);
                overflow: hidden;
            }
            
            .card-enhanced:hover {
                transform: translateY(-4px);
                box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            }
            
            .card-enhanced::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 4px;
                background: linear-gradient(90deg, var(--brand-primary), var(--brand-secondary));
                transform: scaleX(0);
                transition: transform 0.3s ease;
            }
            
            .card-enhanced:hover::before {
                transform: scaleX(1);
            }
            
            /* Enhanced Avatars */
            .avatar-enhanced {
                position: relative;
                display: inline-block;
                border-radius: 50%;
                overflow: hidden;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                transition: all 0.3s ease;
            }
            
            .avatar-enhanced:hover {
                transform: scale(1.05);
                box-shadow: 0 6px 20px rgba(0,0,0,0.2);
            }
            
            .avatar-enhanced::after {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                border: 2px solid var(--brand-primary);
                border-radius: 50%;
                opacity: 0;
                transition: opacity 0.3s ease;
            }
            
            .avatar-enhanced:hover::after {
                opacity: 1;
            }
            
            .avatar-placeholder-enhanced {
                background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: 600;
                font-size: 0.9em;
            }
            
            /* Enhanced Tables */
            .table-enhanced-new {
                border-collapse: separate;
                border-spacing: 0;
                border-radius: 12px;
                overflow: hidden;
                box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            }
            
            .table-enhanced-new thead th {
                background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
                border: none;
                font-weight: 600;
                color: var(--text-primary);
                padding: 1rem;
                position: relative;
            }
            
            .table-enhanced-new thead th::after {
                content: '';
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                height: 2px;
                background: linear-gradient(90deg, var(--brand-primary), var(--brand-secondary));
            }
            
            .table-enhanced-new tbody tr {
                background: var(--bg-primary);
                transition: all 0.2s ease;
                border: none;
            }
            
            .table-enhanced-new tbody tr:hover {
                background: var(--bg-secondary);
                transform: translateX(4px);
                box-shadow: 4px 0 16px rgba(0,0,0,0.1);
            }
            
            .table-enhanced-new tbody td {
                border: none;
                border-bottom: 1px solid var(--border-color);
                padding: 1rem;
                vertical-align: middle;
            }
            
            /* Enhanced Form Elements */
            .form-control-enhanced {
                border: 2px solid var(--border-color);
                border-radius: 8px;
                transition: all 0.3s ease;
                background: var(--bg-primary);
                color: var(--text-primary);
                padding: 0.75rem 1rem;
            }
            
            .form-control-enhanced:focus {
                border-color: var(--brand-primary);
                box-shadow: 0 0 0 0.2rem var(--focus-ring);
                transform: translateY(-1px);
            }
            
            /* Enhanced Badges */
            .badge-enhanced {
                padding: 0.5rem 1rem;
                border-radius: 20px;
                font-weight: 500;
                font-size: 0.8rem;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                position: relative;
                overflow: hidden;
            }
            
            .badge-enhanced::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                transition: left 0.5s;
            }
            
            .badge-enhanced:hover::before {
                left: 100%;
            }
            
            /* Enhanced Progress Bars */
            .progress-enhanced {
                height: 8px;
                border-radius: 20px;
                background: var(--bg-tertiary);
                overflow: hidden;
                position: relative;
            }
            
            .progress-enhanced .progress-bar {
                background: linear-gradient(90deg, var(--brand-primary), var(--brand-secondary));
                border-radius: 20px;
                transition: width 0.6s ease;
                position: relative;
                overflow: hidden;
            }
            
            .progress-enhanced .progress-bar::after {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                bottom: 0;
                right: 0;
                background-image: linear-gradient(
                    -45deg,
                    rgba(255, 255, 255, .2) 25%,
                    transparent 25%,
                    transparent 50%,
                    rgba(255, 255, 255, .2) 50%,
                    rgba(255, 255, 255, .2) 75%,
                    transparent 75%,
                    transparent
                );
                background-size: 30px 30px;
                animation: move 2s linear infinite;
            }
            
            @keyframes move {
                0% { background-position: 0 0; }
                100% { background-position: 30px 30px; }
            }
            
            /* Enhanced Dropdowns */
            .dropdown-menu-enhanced {
                border: none;
                border-radius: 12px;
                box-shadow: 0 8px 32px rgba(0,0,0,0.15);
                background: var(--bg-primary);
                backdrop-filter: blur(10px);
                padding: 0.5rem;
                animation: dropdownFadeIn 0.2s ease;
            }
            
            .dropdown-menu-enhanced .dropdown-item {
                border-radius: 8px;
                padding: 0.75rem 1rem;
                transition: all 0.2s ease;
                color: var(--text-primary);
            }
            
            .dropdown-menu-enhanced .dropdown-item:hover {
                background: var(--bg-secondary);
                transform: translateX(4px);
            }
            
            @keyframes dropdownFadeIn {
                from {
                    opacity: 0;
                    transform: translateY(-10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            
            /* Enhanced Checkboxes */
            .checkbox-enhanced {
                position: relative;
                display: inline-block;
                width: 20px;
                height: 20px;
            }
            
            .checkbox-enhanced input[type="checkbox"] {
                opacity: 0;
                width: 100%;
                height: 100%;
                position: absolute;
                z-index: 1;
                cursor: pointer;
            }
            
            .checkbox-enhanced::before {
                content: '';
                display: block;
                width: 20px;
                height: 20px;
                border: 2px solid var(--border-color);
                border-radius: 4px;
                background: var(--bg-primary);
                transition: all 0.3s ease;
            }
            
            .checkbox-enhanced input[type="checkbox"]:checked + ::before {
                background: var(--brand-primary);
                border-color: var(--brand-primary);
            }
            
            .checkbox-enhanced::after {
                content: '✓';
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) scale(0);
                color: white;
                font-weight: bold;
                font-size: 12px;
                transition: transform 0.2s ease;
            }
            
            .checkbox-enhanced input[type="checkbox"]:checked ~ ::after {
                transform: translate(-50%, -50%) scale(1);
            }
        </style>
    {% endblock %}
</head>

<body>
<!-- Accessibility: Skip Links -->
<a class="skip-link visually-hidden-focusable" href="#main-content">Przejdź do głównej treści</a>
<a class="skip-link visually-hidden-focusable" href="#sidebar">Przejdź do menu</a>

<!-- ARIA Live Region for Dynamic Updates -->
<div aria-live="polite" aria-atomic="true" class="visually-hidden" id="status-announcements"></div>

<div class="d-flex">
    <!-- Enhanced Sidebar -->
    <nav id="sidebar" class="sidebar text-white p-0">
        <div class="sidebar-header p-4">
            <div class="text-center mb-4">
                <div class="sidebar-logo mb-3">
                    <div class="logo-icon">
                        <i class="fas fa-crown"></i>
                    </div>
                    <h4 class="logo-text mb-0">Nowa Nadzieja</h4>
                    <small class="logo-subtitle opacity-75">System CRM</small>
                </div>
            </div>
        </div>

        <div class="sidebar-menu px-3">
            <!-- Sidebar Toggle Button -->
            <div class="sidebar-toggle-container text-center mb-3">
                <button class="sidebar-toggle-btn" id="sidebarToggleBtn" title="Zwiń/Rozwiń menu">
                    <i class="fas fa-angle-double-left"></i>
                </button>
            </div>
            
            <!-- Main Navigation Section -->
            <div class="menu-section mb-4">
                <div class="menu-section-title">
                    <i class="fas fa-home me-2"></i>
                    <span class="section-text">Główne</span>
                </div>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link text-white {% if app.request.get('_route') == 'dashboard' %}active{% endif %}" 
                           href="{{ path('dashboard') }}" 
                           data-tooltip="Dashboard">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                </ul>
            </div>

            {% if is_granted('ROLE_FUNKCYJNY') %}
            <!-- Members Management Section -->
            <div class="menu-section mb-4">
                <div class="menu-section-title">
                    <i class="fas fa-users me-2"></i>
                    <span class="section-text">Zarządzanie członkami</span>
                </div>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link text-white {% if 'czlonek' in app.request.get('_route') %}active{% endif %}" 
                           href="{{ path('czlonek_index') }}" 
                           data-tooltip="Członkowie"
                           data-turbo="false">
                            <i class="fas fa-users"></i>
                            <span>Członkowie</span>
                            <span class="nav-badge">Aktywni</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white {% if 'kandydat' in app.request.get('_route') %}active{% endif %}" 
                           href="{{ path('kandydat_index') }}" 
                           data-tooltip="Kandydaci"
                           data-turbo="false">
                            <i class="fas fa-user-clock"></i>
                            <span>Kandydaci</span>
                        </a>
                    </li>
                    {% if is_granted('ROLE_ZARZAD_KRAJOWY') %}
                    <li class="nav-item">
                        <a class="nav-link text-white {% if 'darczyca' in app.request.get('_route') %}active{% endif %}" 
                           href="{{ path('darczyca_index') }}" 
                           data-tooltip="Darczyńcy">
                            <i class="fas fa-hand-holding-usd"></i>
                            <span>Darczyńcy</span>
                        </a>
                    </li>
                    {% endif %}
                    <li class="nav-item">
                        <a class="nav-link text-white {% if 'mlodziezowka' in app.request.get('_route') %}active{% endif %}" 
                           href="{{ path('mlodziezowka_index') }}" 
                           data-tooltip="Młodzi dla Wolności"
                           data-turbo="false">
                            <i class="fas fa-graduation-cap"></i>
                            <span>Młodzi dla Wolności</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white {% if 'bylo_czlonek' in app.request.get('_route') %}active{% endif %}" 
                           href="{{ path('bylo_czlonek_index') }}" 
                           data-tooltip="Byli członkowie"
                           data-turbo="false">
                            <i class="fas fa-user-times"></i>
                            <span>Byli członkowie</span>
                        </a>
                    </li>
                </ul>
            </div>
            {% endif %}

            {% if is_granted('ROLE_FUNKCYJNY') or is_granted('ROLE_CZLONEK_PARTII') %}
            <!-- Media & Communications Section -->
            <div class="menu-section mb-4">
                <div class="menu-section-title">
                    <i class="fas fa-broadcast-tower me-2"></i>
                    <span class="section-text">Media i komunikacja</span>
                </div>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link text-white {% if 'wystep_medialny' in app.request.get('_route') %}active{% endif %}" 
                           href="{{ path('wystep_medialny_index') }}" 
                           data-tooltip="Wystąpienia medialne">
                            <i class="fas fa-microphone"></i>
                            <span>Wystąpienia medialne</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white {% if 'konferencja_prasowa' in app.request.get('_route') %}active{% endif %}" 
                           href="{{ path('konferencja_prasowa_index') }}" 
                           data-tooltip="Konferencje prasowe">
                            <i class="fas fa-microphone-alt"></i>
                            <span>Konferencje prasowe</span>
                        </a>
                    </li>
                </ul>
            </div>
            {% endif %}

            {% if is_granted('ROLE_KANDYDAT_PARTII') %}
            <!-- Candidate Section -->
            <div class="menu-section mb-4">
                <div class="menu-section-title">
                    <i class="fas fa-user-graduate me-2"></i>
                    <span class="section-text">Proces kandydowania</span>
                </div>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link text-white {% if 'postep_kandydata' in app.request.get('_route') %}active{% endif %}" 
                           href="{{ path('postep_kandydata_index') }}" 
                           data-tooltip="Mój postęp w procesie kandydowania">
                            <i class="fas fa-tasks"></i>
                            <span>Mój postęp</span>
                        </a>
                    </li>
                </ul>
            </div>
            {% endif %}

            {% if is_granted('ROLE_CZLONEK_PARTII') or is_granted('ROLE_FUNKCYJNY') %}
            <!-- Documents & Profile Section -->
            <div class="menu-section mb-4">
                <div class="menu-section-title">
                    <i class="fas fa-folder me-2"></i>
                    <span class="section-text">Dokumenty i profil</span>
                </div>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link text-white {% if 'dokument' in app.request.get('_route') %}active{% endif %}" 
                           href="{{ path('dokument_index') }}" 
                           data-tooltip="Dokumenty">
                            <i class="fas fa-file-signature"></i>
                            <span>Dokumenty</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white {% if 'profil' in app.request.get('_route') %}active{% endif %}" 
                           href="{{ path('profil_index') }}" 
                           data-tooltip="Mój profil">
                            <i class="fas fa-user-circle"></i>
                            <span>Mój profil</span>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Payment Section -->
            <div class="menu-section mb-4">
                <div class="menu-section-title">
                    <i class="fas fa-coins me-2"></i>
                    <span class="section-text">Rozliczenia składek</span>
                </div>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link text-white {% if 'payment' in app.request.get('_route') and not ('admin' in app.request.get('_route') or 'import' in app.request.get('_route')) %}active{% endif %}" 
                           href="{{ path('app_payment_index') }}" 
                           data-tooltip="Moje składki">
                            <i class="fas fa-wallet"></i>
                            <span>Moje składki</span>
                        </a>
                    </li>
                    {% if is_granted('ROLE_SKARBNIK_PARTII') %}
                    <li class="nav-item">
                        <a class="nav-link text-white {% if 'payment' in app.request.get('_route') and ('admin' in app.request.get('_route') or 'import' in app.request.get('_route')) %}active{% endif %}" 
                           href="{{ path('app_payment_admin') }}" 
                           data-tooltip="Panel Skarbnika">
                            <i class="fas fa-calculator"></i>
                            <span>Panel Skarbnika</span>
                        </a>
                    </li>
                    {% endif %}
                    {% if is_granted('ROLE_SKARBNIK_OKREGU') or is_granted('ROLE_SKARBNIK_PARTII') or is_granted('ROLE_PREZES_OKREGU') or is_granted('ROLE_WICEPREZES_OKREGU') or is_granted('ROLE_SEKRETARZ_OKREGU') %}
                    <li class="nav-item">
                        <a class="nav-link text-white {% if 'faktura' in app.request.get('_route') %}active{% endif %}" 
                           href="{{ path('faktura_index') }}" 
                           data-tooltip="Faktury">
                            <i class="fas fa-file-invoice-dollar"></i>
                            <span>Faktury</span>
                        </a>
                    </li>
                    {% endif %}
                    {% if is_granted('ROLE_SKARBNIK_PARTII') %}
                    <li class="nav-item">
                        <a class="nav-link text-white {% if 'umowa' in app.request.get('_route') %}active{% endif %}" 
                           href="{{ path('umowa_index') }}" 
                           data-tooltip="Umowy zlecenia">
                            <i class="fas fa-file-contract"></i>
                            <span>Umowy zlecenia</span>
                        </a>
                    </li>
                    {% endif %}
                    
                    {# Umowy zlecenia dla zleceniobiorców - tylko ich własne umowy #}
                    {% if not is_granted('ROLE_SKARBNIK_PARTII') %}
                    <li class="nav-item">
                        <a class="nav-link text-white {% if 'umowa' in app.request.get('_route') %}active{% endif %}" 
                           href="{{ path('umowa_index') }}" 
                           data-tooltip="Moje umowy zlecenia">
                            <i class="fas fa-file-signature"></i>
                            <span>Moje umowy</span>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </div>
            {% elseif is_granted('ROLE_KANDYDAT_PARTII') %}
            <!-- Candidate Profile Section -->
            <div class="menu-section mb-4">
                <div class="menu-section-title">
                    <i class="fas fa-user me-2"></i>
                    <span class="section-text">Profil</span>
                </div>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link text-white {% if 'profil' in app.request.get('_route') %}active{% endif %}" 
                           href="{{ path('profil_index') }}" 
                           data-tooltip="Mój profil">
                            <i class="fas fa-user-circle"></i>
                            <span>Mój profil</span>
                        </a>
                    </li>
                </ul>
            </div>
            {% elseif is_granted('ROLE_BYLY_CZLONEK') %}
            <!-- Former Member Profile Section -->
            <div class="menu-section mb-4">
                <div class="menu-section-title">
                    <i class="fas fa-user-clock me-2"></i>
                    <span class="section-text">Były członek</span>
                </div>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link text-white {% if 'profil' in app.request.get('_route') %}active{% endif %}" 
                           href="{{ path('profil_index') }}" 
                           data-tooltip="Mój profil">
                            <i class="fas fa-user-circle"></i>
                            <span>Mój profil</span>
                        </a>
                    </li>
                </ul>
            </div>
            {% endif %}

            {% if is_granted('ROLE_CZLONEK_PARTII') or is_granted('ROLE_OBSERWATOR_ZEBRANIA') or is_granted('ROLE_PROTOKOLANT_ZEBRANIA') or is_granted('ROLE_PROWADZACY_ZEBRANIA') %}
            <!-- Organization Info Section for Members -->
            <div class="menu-section mb-4">
                <div class="menu-section-title">
                    <i class="fas fa-sitemap me-2"></i>
                    <span class="section-text">Moja organizacja</span>
                </div>
                <ul class="nav flex-column">
                    {% if app.user.oddzial %}
                    <li class="nav-item">
                        <a class="nav-link text-white {% if 'zarzad_oddzialu' in app.request.get('_route') %}active{% endif %}" 
                           href="{{ path('zarzad_oddzialu_index') }}" 
                           data-tooltip="Zarząd oddziału">
                            <i class="fas fa-users"></i>
                            <span>Zarząd oddziału</span>
                        </a>
                    </li>
                    {% endif %}
                    {% if app.user.okreg %}
                    <li class="nav-item">
                        <a class="nav-link text-white {% if 'zarzad_okregu' in app.request.get('_route') %}active{% endif %}" 
                           href="{{ path('zarzad_okregu_index') }}" 
                           data-tooltip="Zarząd okręgu">
                            <i class="fas fa-users-cog"></i>
                            <span>Zarząd okręgu</span>
                        </a>
                    </li>
                    {% endif %}
                    
                    <!-- Walne Zebrania -->
                    {% if is_granted('ROLE_SEKRETARZ_OKREGU') or is_granted('ROLE_SEKRETARZ_PARTII') or is_granted('ROLE_OBSERWATOR_ZEBRANIA') or is_granted('ROLE_PROTOKOLANT_ZEBRANIA') or is_granted('ROLE_PROWADZACY_ZEBRANIA') or is_granted('ROLE_ADMIN') %}
                    <li class="nav-item has-submenu">
                        <a class="nav-link text-white {% if 'zebranie_' in app.request.get('_route') %}active{% endif %}" 
                           href="#"
                           data-bs-toggle="collapse"
                           data-bs-target="#walneZebraniaSubmenu"
                           aria-expanded="{% if 'zebranie_' in app.request.get('_route') %}true{% else %}false{% endif %}"
                           data-tooltip="Walne zebrania partii">
                            <i class="fas fa-gavel"></i>
                            <span>Walne zebrania</span>
                            {% if is_granted('ROLE_PROTOKOLANT_ZEBRANIA') or is_granted('ROLE_PROWADZACY_ZEBRANIA') %}
                                <span class="nav-badge">Aktywne</span>
                            {% endif %}
                            <i class="fas fa-chevron-down submenu-icon"></i>
                        </a>
                        <div class="collapse {% if 'zebranie_' in app.request.get('_route') %}show{% endif %}" id="walneZebraniaSubmenu">
                            <ul class="nav flex-column submenu">
                                {% if is_granted('ROLE_SEKRETARZ_OKREGU') or is_granted('ROLE_OBSERWATOR_ZEBRANIA') or is_granted('ROLE_PROTOKOLANT_ZEBRANIA') or is_granted('ROLE_PROWADZACY_ZEBRANIA') or is_granted('ROLE_ADMIN') %}
                                <li class="nav-item">
                                    <a class="nav-link text-white {% if 'zebranie_oddzialu' in app.request.get('_route') %}active{% endif %}" 
                                       href="{{ path('zebranie_oddzialu_index') }}">
                                        <i class="fas fa-users"></i>
                                        <span>Zebrania Członków Oddziału</span>
                                    </a>
                                </li>
                                {% endif %}
                                {% if is_granted('ROLE_SEKRETARZ_PARTII') or is_granted('ROLE_OBSERWATOR_ZEBRANIA') or is_granted('ROLE_PROTOKOLANT_ZEBRANIA') or is_granted('ROLE_PROWADZACY_ZEBRANIA') or is_granted('ROLE_ADMIN') %}
                                <li class="nav-item">
                                    <a class="nav-link text-white {% if 'zebranie_okregu' in app.request.get('_route') %}active{% endif %}" 
                                       href="{{ path('zebranie_okregu_index') }}">
                                        <i class="fas fa-users-cog"></i>
                                        <span>Zebrania Członków Okręgu</span>
                                    </a>
                                </li>
                                {% endif %}
                            </ul>
                        </div>
                    </li>
                    {% endif %}
                </ul>
            </div>
            {% endif %}

            {% if false %}
            <!-- Placeholder for future sections -->
            <div class="menu-section mb-4">
                <div class="menu-section-title">
                    <i class="fas fa-sitemap me-2"></i>
                    <span class="section-text">Placeholder</span>
                </div>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link text-white" 
                           href="#" 
                           data-tooltip="Zarząd oddziału">
                            <i class="fas fa-users"></i>
                            <span>Zarząd oddziału</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" 
                           href="#" 
                           data-tooltip="Zarząd okręgu">
                            <i class="fas fa-building"></i>
                            <span>Zarząd okręgu</span>
                        </a>
                    </li>
                </ul>
            </div>
            {% endif %}
            
            <!-- User Actions Section -->
            <div class="menu-section">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link text-white logout-link" 
                           href="{{ path('logout') }}" 
                           data-tooltip="Wyloguj się">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Wyloguj się</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        </div>
    </nav>

    <!-- Main content -->
    <main id="main-content" class="p-4" role="main">
        <!-- Enhanced Desktop Header -->
        <div class="d-none d-md-flex justify-content-between align-items-center mb-4">
            <div class="header-left d-flex align-items-center flex-grow-1">
                <!-- Enhanced Hamburger Button -->
                <button type="button" id="sidebarCollapse" class="hamburger-btn me-3" title="Przełącz sidebar">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
                
                <!-- Enhanced Breadcrumb with Current Section -->
                <div class="header-navigation flex-grow-1">
                    <div class="current-section">
                        <div class="section-info">
                            <h1 class="section-title">{% block page_title %}Dashboard{% endblock %}</h1>
                            <div class="section-breadcrumb">
                                <nav aria-label="breadcrumb">
                                    <ol class="breadcrumb mb-0">
                                        <li class="breadcrumb-item">
                                            <a href="{{ path('dashboard') }}" class="text-decoration-none">
                                                <i class="fas fa-home me-1"></i>Home
                                            </a>
                                        </li>
                                        {% block breadcrumbs %}{% endblock %}
                                        <li class="breadcrumb-item active" aria-current="page">
                                            {% block page_title_breadcrumb %}{{ block('page_title') }}{% endblock %}
                                        </li>
                                    </ol>
                                </nav>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Page Actions -->
                    <div class="page-actions">
                        {% block page_actions %}{% endblock %}
                    </div>
                </div>
            </div>
            
            <!-- Enhanced Profile Section -->
            {% if app.user %}
            <div class="header-profile">
                <div class="profile-dropdown">
                    <a href="#" class="profile-toggle" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <div class="profile-info">
                            <div class="profile-avatar">
                                {% if app.user.zdjecie %}
                                    <img src="{{ asset('uploads/photos/' ~ app.user.zdjecie) }}" 
                                         alt="Zdjęcie {{ app.user.fullName }}">
                                {% else %}
                                    <div class="avatar-placeholder">
                                        <i class="fas fa-user"></i>
                                    </div>
                                {% endif %}
                            </div>
                            <div class="profile-text">
                                <div class="profile-name">{{ app.user.fullName }}</div>
                                <div class="profile-role">{{ app.user.okreg ? app.user.okreg.nazwa : 'System CRM' }}</div>
                            </div>
                            <div class="profile-arrow">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </div>
                    </a>
                    
                    <!-- Profile Dropdown Menu -->
                    <ul class="dropdown-menu dropdown-menu-end profile-dropdown-menu" aria-labelledby="profileDropdown">
                        <li>
                            <a class="dropdown-item" href="{{ path('profil_index') }}">
                                <i class="fas fa-user me-2"></i>Mój profil
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{{ path('profil_edit') }}">
                                <i class="fas fa-edit me-2"></i>Edytuj profil
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{{ path('profil_photo') }}">
                                <i class="fas fa-camera me-2"></i>Zarządzaj zdjęciem
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item text-danger" href="{{ path('logout') }}">
                                <i class="fas fa-sign-out-alt me-2"></i>Wyloguj się
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            {% endif %}
        </div>
        
        <!-- Enhanced Mobile Header -->
        <div class="d-md-none mobile-header">
            <div class="d-flex justify-content-between align-items-center">
                <!-- Enhanced Mobile Menu Toggle -->
                <button type="button" id="mobileMenuToggle" class="mobile-hamburger-btn">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
                
                <!-- Mobile Page Title -->
                <div class="mobile-title">
                    <h2 class="mb-0">{% block mobile_page_title %}{{ block('page_title') }}{% endblock %}</h2>
                </div>
                
                <!-- Enhanced Mobile Profile -->
                {% if app.user %}
                <div class="mobile-profile">
                    <a href="{{ path('profil_index') }}" class="mobile-profile-link">
                        <div class="mobile-profile-avatar">
                            {% if app.user.zdjecie %}
                                <img src="{{ asset('uploads/photos/' ~ app.user.zdjecie) }}" 
                                     alt="Zdjęcie {{ app.user.fullName }}">
                            {% else %}
                                <div class="mobile-avatar-placeholder">
                                    <i class="fas fa-user"></i>
                                </div>
                            {% endif %}
                        </div>
                    </a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Flash messages -->
        {% for type, messages in app.flashes %}
            {% for message in messages %}
                <div class="alert alert-{{ type == 'error' ? 'danger' : type }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endfor %}

        <!-- Page content -->
        {% block body %}{% endblock %}
    </main>
</div>

<!-- Mobile Sidebar Overlay -->
<div class="sidebar-overlay" id="sidebarOverlay"></div>

<!-- Theme Toggle Button -->
<button class="theme-toggle" id="themeToggle" title="Przełącz tryb ciemny" data-turbo-permanent>
    <i class="fas fa-moon" id="themeIcon"></i>
</button>

<!-- Mobile Bottom Navigation Removed - Using Hamburger Menu Instead -->

<!-- Loading Spinner -->
<div class="spinner-overlay" id="loadingSpinner">
    <div class="text-center">
        <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">Ładowanie...</span>
        </div>
        <div class="text-muted">Proszę czekać...</div>
    </div>
</div>

{% block javascripts %}
    <script src="{{ asset('js/meeting-realtime.js') }}" type="text/javascript"></script>
    <script>
        // Global function definitions (Turbo-safe)
        window.setupThemeToggle = function() {
            const themeToggle = document.getElementById('themeToggle');
            const themeIcon = document.getElementById('themeIcon');
            const html = document.documentElement;
            
            if (!themeToggle || !themeIcon) return;
            
            // Remove old event listeners if exists
            if (window.themeToggleHandler) {
                themeToggle.removeEventListener('click', window.themeToggleHandler);
            }

            // Initialize theme based on localStorage or system preference
            function initializeTheme() {
                const savedTheme = localStorage.getItem('theme');
                const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                
                let isDark = false;
                
                if (savedTheme === 'dark') {
                    isDark = true;
                } else if (savedTheme === 'light') {
                    isDark = false;
                } else if (systemPrefersDark) {
                    isDark = true;
                }
                
                if (isDark) {
                    html.setAttribute('data-theme', 'dark');
                    themeIcon.className = 'fas fa-sun';
                    themeToggle.title = 'Przełącz tryb jasny';
                } else {
                    html.removeAttribute('data-theme');
                    themeIcon.className = 'fas fa-moon';
                    themeToggle.title = 'Przełącz tryb ciemny';
                }
            }
            
            initializeTheme();
            
            // System preference change listener
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                if (!localStorage.getItem('theme')) {
                    if (e.matches) {
                        html.setAttribute('data-theme', 'dark');
                        themeIcon.className = 'fas fa-sun';
                        themeToggle.title = 'Przełącz tryb jasny';
                    } else {
                        html.removeAttribute('data-theme');
                        themeIcon.className = 'fas fa-moon';
                        themeToggle.title = 'Przełącz tryb ciemny';
                    }
                }
            });

            // Theme toggle event listener
            window.themeToggleHandler = function() {
                const currentTheme = html.getAttribute('data-theme');
                
                if (currentTheme === 'dark') {
                    // Switch to light mode
                    html.removeAttribute('data-theme');
                    themeIcon.className = 'fas fa-moon';
                    localStorage.setItem('theme', 'light');
                    themeToggle.title = 'Przełącz tryb ciemny';
                } else {
                    // Switch to dark mode
                    html.setAttribute('data-theme', 'dark');
                    themeIcon.className = 'fas fa-sun';
                    localStorage.setItem('theme', 'dark');
                    themeToggle.title = 'Przełącz tryb jasny';
                }
                
                // Add a subtle animation effect with haptic feedback
                themeToggle.style.transform = 'scale(0.9)';
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
                setTimeout(() => {
                    themeToggle.style.transform = 'scale(1)';
                }, 150);
            };
            
            // Add new event listener
            themeToggle.addEventListener('click', window.themeToggleHandler);
        };

        document.addEventListener("DOMContentLoaded", function(){
            // Enhanced Sidebar functionality
            const sidebar = document.getElementById('sidebar');
            const sidebarCollapseBtn = document.getElementById('sidebarCollapse');
            const sidebarToggleBtn = document.getElementById('sidebarToggleBtn');
            
            // Load sidebar states from localStorage
            const sidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
            const sidebarHidden = localStorage.getItem('sidebarHidden') === 'true';
            
            if (sidebarCollapsed && sidebar) {
                sidebar.classList.add('collapsed');
                document.body.classList.add('sidebar-collapsed');
            }
            
            if (sidebarHidden && sidebar) {
                sidebar.classList.add('active');
                document.body.classList.add('sidebar-hidden');
                if (sidebarCollapseBtn) {
                    sidebarCollapseBtn.classList.add('active');
                }
            }
            
            // Enhanced Desktop Sidebar toggle
            if (sidebarCollapseBtn) {
                sidebarCollapseBtn.addEventListener('click', function () {
                    sidebar.classList.toggle('active');
                    
                    // Toggle body class for content width adjustment
                    if (sidebar.classList.contains('active')) {
                        document.body.classList.add('sidebar-hidden');
                    } else {
                        document.body.classList.remove('sidebar-hidden');
                    }
                    
                    // Toggle hamburger animation
                    this.classList.toggle('active');
                    
                    // Add ripple effect
                    const ripple = document.createElement('span');
                    const rect = this.getBoundingClientRect();
                    const size = Math.max(rect.width, rect.height);
                    const x = 23 - size / 2; // Center of button
                    const y = 23 - size / 2;
                    
                    ripple.style.width = ripple.style.height = size + 'px';
                    ripple.style.left = x + 'px';
                    ripple.style.top = y + 'px';
                    ripple.style.position = 'absolute';
                    ripple.style.borderRadius = '50%';
                    ripple.style.background = 'rgba(255,255,255,0.3)';
                    ripple.style.transform = 'scale(0)';
                    ripple.style.animation = 'ripple 0.6s linear';
                    ripple.style.pointerEvents = 'none';
                    
                    this.style.position = 'relative';
                    this.style.overflow = 'hidden';
                    this.appendChild(ripple);
                    
                    setTimeout(() => {
                        if (ripple.parentNode) {
                            ripple.parentNode.removeChild(ripple);
                        }
                    }, 600);
                    
                    // Save state to localStorage
                    localStorage.setItem('sidebarHidden', sidebar.classList.contains('active') ? 'true' : 'false');
                });
            }
            
            // Sidebar collapse/expand toggle
            if (sidebarToggleBtn && sidebar) {
                sidebarToggleBtn.addEventListener('click', function() {
                    const isCollapsed = sidebar.classList.contains('collapsed');
                    
                    if (isCollapsed) {
                        sidebar.classList.remove('collapsed');
                        document.body.classList.remove('sidebar-collapsed');
                        localStorage.setItem('sidebarCollapsed', 'false');
                    } else {
                        sidebar.classList.add('collapsed');
                        document.body.classList.add('sidebar-collapsed');
                        localStorage.setItem('sidebarCollapsed', 'true');
                    }
                    
                    // Add ripple effect
                    const ripple = document.createElement('span');
                    ripple.style.position = 'absolute';
                    ripple.style.borderRadius = '50%';
                    ripple.style.transform = 'scale(0)';
                    ripple.style.animation = 'ripple 0.6s linear';
                    ripple.style.backgroundColor = 'rgba(255,255,255,0.6)';
                    ripple.style.left = '50%';
                    ripple.style.top = '50%';
                    ripple.style.width = '40px';
                    ripple.style.height = '40px';
                    ripple.style.marginLeft = '-20px';
                    ripple.style.marginTop = '-20px';
                    
                    sidebarToggleBtn.style.position = 'relative';
                    sidebarToggleBtn.appendChild(ripple);
                    
                    setTimeout(() => {
                        if (ripple.parentNode) {
                            ripple.parentNode.removeChild(ripple);
                        }
                    }, 600);
                });
            }
            
            // Add ripple effect to sidebar links
            const sidebarLinks = document.querySelectorAll('.sidebar .nav-link');
            sidebarLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    // Don't add ripple effect if sidebar is collapsed
                    if (sidebar && sidebar.classList.contains('collapsed')) {
                        return;
                    }
                    
                    const rect = this.getBoundingClientRect();
                    const size = Math.max(rect.width, rect.height);
                    const x = e.clientX - rect.left - size / 2;
                    const y = e.clientY - rect.top - size / 2;
                    
                    const ripple = document.createElement('span');
                    ripple.style.width = ripple.style.height = size + 'px';
                    ripple.style.left = x + 'px';
                    ripple.style.top = y + 'px';
                    ripple.style.position = 'absolute';
                    ripple.style.borderRadius = '50%';
                    ripple.style.background = 'rgba(255,255,255,0.3)';
                    ripple.style.transform = 'scale(0)';
                    ripple.style.animation = 'ripple 0.6s linear';
                    ripple.style.pointerEvents = 'none';
                    
                    this.style.position = 'relative';
                    this.style.overflow = 'hidden';
                    this.appendChild(ripple);
                    
                    setTimeout(() => {
                        if (ripple.parentNode) {
                            ripple.parentNode.removeChild(ripple);
                        }
                    }, 600);
                });
            });
            
            // Add CSS for ripple animation if not exists
            if (!document.querySelector('#sidebarRippleCSS')) {
                const style = document.createElement('style');
                style.id = 'sidebarRippleCSS';
                style.textContent = `
                    @keyframes ripple {
                        to {
                            transform: scale(4);
                            opacity: 0;
                        }
                    }
                `;
                document.head.appendChild(style);
            }
            
            // Mobile Sidebar toggle
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const sidebarOverlay = document.getElementById('sidebarOverlay');
            
            if (mobileMenuToggle && sidebar && sidebarOverlay) {
                mobileMenuToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('active');
                    sidebarOverlay.classList.toggle('show');
                    
                    // Toggle mobile hamburger animation
                    this.classList.toggle('active');
                    
                    // Add mobile ripple effect
                    const ripple = document.createElement('span');
                    const rect = this.getBoundingClientRect();
                    const size = Math.max(rect.width, rect.height);
                    const x = 22 - size / 2; // Center of button
                    const y = 22 - size / 2;
                    
                    ripple.style.width = ripple.style.height = size + 'px';
                    ripple.style.left = x + 'px';
                    ripple.style.top = y + 'px';
                    ripple.style.position = 'absolute';
                    ripple.style.borderRadius = '50%';
                    ripple.style.background = 'rgba(255,255,255,0.3)';
                    ripple.style.transform = 'scale(0)';
                    ripple.style.animation = 'ripple 0.6s linear';
                    ripple.style.pointerEvents = 'none';
                    
                    this.style.position = 'relative';
                    this.style.overflow = 'hidden';
                    this.appendChild(ripple);
                    
                    setTimeout(() => {
                        if (ripple.parentNode) {
                            ripple.parentNode.removeChild(ripple);
                        }
                    }, 600);
                });
                
                // Close sidebar when clicking overlay
                sidebarOverlay.addEventListener('click', function() {
                    sidebar.classList.remove('active');
                    sidebarOverlay.classList.remove('show');
                    
                    // Reset mobile hamburger animation
                    mobileMenuToggle.classList.remove('active');
                });
                
                // Close sidebar when clicking on links (mobile)
                const sidebarLinks = sidebar.querySelectorAll('.nav-link');
                sidebarLinks.forEach(link => {
                    link.addEventListener('click', function() {
                        if (window.innerWidth <= 768) {
                            sidebar.classList.remove('active');
                            sidebarOverlay.classList.remove('show');
                            
                            // Reset mobile hamburger animation
                            mobileMenuToggle.classList.remove('active');
                        }
                    });
                });
                
                // Handle window resize
                window.addEventListener('resize', function() {
                    if (window.innerWidth > 768) {
                        sidebar.classList.remove('active');
                        sidebarOverlay.classList.remove('show');
                        
                        // Reset mobile hamburger animation
                        mobileMenuToggle.classList.remove('active');
                    }
                });
            }

            // Loading spinner for forms
            const forms = document.querySelectorAll('form[method="post"]');
            forms.forEach(form => {
                form.addEventListener('submit', function() {
                    const loadingSpinner = document.getElementById('loadingSpinner');
                    if (loadingSpinner) {
                        loadingSpinner.classList.add('show');
                    }
                });
            });

            // Loading spinner for navigation links with data-loading
            const loadingLinks = document.querySelectorAll('a[data-loading="true"]');
            loadingLinks.forEach(link => {
                link.addEventListener('click', function() {
                    const loadingSpinner = document.getElementById('loadingSpinner');
                    if (loadingSpinner) {
                        loadingSpinner.classList.add('show');
                    }
                });
            });

            // Auto-hide alerts after longer time based on content
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                // Calculate display time based on message length and type
                const messageLength = alert.textContent.length;
                const isWarning = alert.classList.contains('alert-warning');
                const isDanger = alert.classList.contains('alert-danger');
                
                // Base time: 8 seconds for normal, 15 seconds for warnings/dangers
                let baseTime = (isWarning || isDanger) ? 15000 : 8000;
                
                // Add extra time for longer messages (100ms per 10 characters)
                const extraTime = Math.floor(messageLength / 10) * 100;
                const totalTime = Math.min(baseTime + extraTime, 30000); // Max 30 seconds
                
                setTimeout(() => {
                    if (alert && alert.parentNode) {
                        alert.style.transition = 'opacity 0.5s ease-out';
                        alert.style.opacity = '0';
                        setTimeout(() => {
                            if (alert.parentNode) {
                                alert.parentNode.removeChild(alert);
                            }
                        }, 500);
                    }
                }, totalTime);
            });

            // Smooth scrolling for internal links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth'
                        });
                    }
                });
            });

            // Enhanced tooltips
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });

            // Setup theme toggle functionality
            window.setupThemeToggle();
        });
        
        // Re-setup theme toggle on Turbo navigation
        document.addEventListener('turbo:load', function() {
            window.setupThemeToggle();
        });
        
        document.addEventListener('turbo:render', function() {
            // Re-apply theme after Turbo renders
            const savedTheme = localStorage.getItem('theme');
            const html = document.documentElement;
            
            if (savedTheme === 'dark') {
                html.setAttribute('data-theme', 'dark');
            } else if (savedTheme === 'light') {
                html.removeAttribute('data-theme');
            }
        });

        // ========== ENHANCED VISUAL IMPROVEMENTS JAVASCRIPT ========== 
        
        // Loading Overlay Functions
        window.showLoading = function(message = 'Ładowanie...') {
            const overlay = document.getElementById('loadingOverlay') || createLoadingOverlay();
            const loadingText = overlay.querySelector('.loading-text');
            if (loadingText) {
                loadingText.textContent = message;
            }
            overlay.classList.add('show');
        };
        
        window.hideLoading = function() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.classList.remove('show');
            }
        };
        
        function createLoadingOverlay() {
            const overlay = document.createElement('div');
            overlay.id = 'loadingOverlay';
            overlay.className = 'loading-overlay';
            overlay.innerHTML = `
                <div class="text-center">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Ładowanie...</div>
                </div>
            `;
            document.body.appendChild(overlay);
            return overlay;
        }
        
        // Enhanced Toast Notifications
        window.showToast = function(message, type = 'info', duration = 4000) {
            const container = document.querySelector('.toast-container') || createToastContainer();
            
            const toast = document.createElement('div');
            toast.className = `toast-enhanced ${type}`;
            toast.innerHTML = `
                <div class="d-flex align-items-center p-3">
                    <div class="me-3">
                        <i class="fas ${getToastIcon(type)}"></i>
                    </div>
                    <div class="flex-grow-1">
                        <strong>${getToastTitle(type)}</strong>
                        <div>${message}</div>
                    </div>
                    <button type="button" class="btn-close btn-close-white ms-3" onclick="this.parentElement.parentElement.remove()"></button>
                </div>
            `;
            
            container.appendChild(toast);
            
            // Auto remove after duration
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.style.animation = 'slideOutRight 0.3s ease';
                    setTimeout(() => toast.remove(), 300);
                }
            }, duration);
        };
        
        function createToastContainer() {
            const container = document.createElement('div');
            container.className = 'toast-container';
            document.body.appendChild(container);
            return container;
        }
        
        function getToastIcon(type) {
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            return icons[type] || icons.info;
        }
        
        function getToastTitle(type) {
            const titles = {
                success: 'Sukces',
                error: 'Błąd',
                warning: 'Ostrzeżenie',
                info: 'Informacja'
            };
            return titles[type] || titles.info;
        }
        
        // Enhanced Export Functions with Loading
        window.exportDataWithLoading = function(format, selectedIds = null) {
            showLoading(`Przygotowywanie eksportu ${format.toUpperCase()}...`);
            
            // Simulate export delay for better UX
            setTimeout(() => {
                // Call original export function here
                if (window.exportData) {
                    window.exportData(format, selectedIds);
                }
                hideLoading();
                showToast(`Eksport ${format.toUpperCase()} został rozpoczęty`, 'success');
            }, 800);
        };
        
        // Enhanced Avatar Generation
        window.generateAvatar = function(name, size = 40) {
            const initials = name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
            const colors = [
                'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',
                'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)',
                'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)'
            ];
            
            const colorIndex = name.charCodeAt(0) % colors.length;
            
            return `
                <div class="avatar-enhanced avatar-placeholder-enhanced" 
                     style="width: ${size}px; height: ${size}px; background: ${colors[colorIndex]};">
                    ${initials}
                </div>
            `;
        };
        
        // Progress Animation
        window.animateProgress = function(element, targetWidth, duration = 1000) {
            if (!element) return;
            
            element.style.width = '0%';
            element.style.transition = `width ${duration}ms ease`;
            
            requestAnimationFrame(() => {
                element.style.width = targetWidth + '%';
            });
        };
        
        // Enhanced Button Click Effects
        document.addEventListener('click', function(e) {
            // Find the closest btn-enhanced element (handles clicks on child elements like icons)
            const btn = e.target.closest('.btn-enhanced');
            if (btn) {
                const ripple = document.createElement('span');
                const rect = btn.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                const x = e.clientX - rect.left - size / 2;
                const y = e.clientY - rect.top - size / 2;
                
                ripple.style.cssText = `
                    position: absolute;
                    width: ${size}px;
                    height: ${size}px;
                    left: ${x}px;
                    top: ${y}px;
                    background: rgba(255, 255, 255, 0.5);
                    border-radius: 50%;
                    transform: scale(0);
                    animation: ripple 0.6s linear;
                    pointer-events: none;
                `;
                
                btn.style.position = 'relative';
                btn.style.overflow = 'hidden';
                btn.appendChild(ripple);
                
                ripple.addEventListener('animationend', () => ripple.remove());
            }
        });
        
        // Add ripple animation keyframes
        if (!document.getElementById('ripple-styles')) {
            const rippleStyle = document.createElement('style');
            rippleStyle.id = 'ripple-styles';
        rippleStyle.textContent = `
            @keyframes ripple {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }
            @keyframes slideOutRight {
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
            document.head.appendChild(rippleStyle);
        }
        
        // Auto-apply enhanced classes to existing elements
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-enhance buttons
            document.querySelectorAll('.btn:not(.btn-enhanced)').forEach(btn => {
                if (!btn.classList.contains('btn-sm') && !btn.classList.contains('btn-lg')) {
                    btn.classList.add('btn-enhanced');
                }
            });
            
            // Auto-enhance cards
            document.querySelectorAll('.card:not(.card-enhanced)').forEach(card => {
                card.classList.add('card-enhanced');
            });
            
            // Auto-enhance form controls
            document.querySelectorAll('.form-control:not(.form-control-enhanced)').forEach(input => {
                input.classList.add('form-control-enhanced');
            });
            
            // Auto-enhance badges
            document.querySelectorAll('.badge:not(.badge-enhanced)').forEach(badge => {
                badge.classList.add('badge-enhanced');
            });
            
            // Auto-enhance avatars
            document.querySelectorAll('.avatar, .member-avatar, .avatar-sm').forEach(avatar => {
                avatar.classList.add('avatar-enhanced');
            });
            
            // Auto-enhance dropdown menus
            document.querySelectorAll('.dropdown-menu:not(.dropdown-menu-enhanced)').forEach(menu => {
                menu.classList.add('dropdown-menu-enhanced');
            });
        });
    </script>
{% endblock %}
</body>
</html>